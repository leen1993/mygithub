/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/9.0.2
 * Generated at: 2018-05-14 01:46:35 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.WEB_002dINF.view.expense.outpatient.fee;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import com.rekj.platform.model.system.SysResource;

public final class outFeeChargeList_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent,
                 org.apache.jasper.runtime.JspSourceImports {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  static {
    _jspx_dependants = new java.util.HashMap<java.lang.String,java.lang.Long>(6);
    _jspx_dependants.put("jar:file:/E:/workspace.hisnew/hisbase/WebContent/WEB-INF/lib/jstl-1.2.jar!/META-INF/fn.tld", Long.valueOf(1153356282000L));
    _jspx_dependants.put("jar:file:/E:/workspace.hisnew/hisbase/WebContent/WEB-INF/lib/jstl-1.2.jar!/META-INF/c.tld", Long.valueOf(1153356282000L));
    _jspx_dependants.put("/WEB-INF/lib/jstl-1.2.jar", Long.valueOf(1525761782870L));
    _jspx_dependants.put("/commons/include/html_doctype.html", Long.valueOf(1525761798654L));
    _jspx_dependants.put("/commons/include/get.jsp", Long.valueOf(1525827802831L));
    _jspx_dependants.put("jar:file:/E:/workspace.hisnew/hisbase/WebContent/WEB-INF/lib/jstl-1.2.jar!/META-INF/fmt.tld", Long.valueOf(1153356282000L));
  }

  private static final java.util.Set<java.lang.String> _jspx_imports_packages;

  private static final java.util.Set<java.lang.String> _jspx_imports_classes;

  static {
    _jspx_imports_packages = new java.util.HashSet<>();
    _jspx_imports_packages.add("javax.servlet");
    _jspx_imports_packages.add("javax.servlet.http");
    _jspx_imports_packages.add("javax.servlet.jsp");
    _jspx_imports_classes = new java.util.HashSet<>();
    _jspx_imports_classes.add("com.rekj.platform.model.system.SysResource");
  }

  private org.apache.jasper.runtime.TagHandlerPool _005fjspx_005ftagPool_005fc_005fset_0026_005fvar_005fvalue_005fnobody;

  private volatile javax.el.ExpressionFactory _el_expressionfactory;
  private volatile org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public java.util.Set<java.lang.String> getPackageImports() {
    return _jspx_imports_packages;
  }

  public java.util.Set<java.lang.String> getClassImports() {
    return _jspx_imports_classes;
  }

  public javax.el.ExpressionFactory _jsp_getExpressionFactory() {
    if (_el_expressionfactory == null) {
      synchronized (this) {
        if (_el_expressionfactory == null) {
          _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
        }
      }
    }
    return _el_expressionfactory;
  }

  public org.apache.tomcat.InstanceManager _jsp_getInstanceManager() {
    if (_jsp_instancemanager == null) {
      synchronized (this) {
        if (_jsp_instancemanager == null) {
          _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
        }
      }
    }
    return _jsp_instancemanager;
  }

  public void _jspInit() {
    _005fjspx_005ftagPool_005fc_005fset_0026_005fvar_005fvalue_005fnobody = org.apache.jasper.runtime.TagHandlerPool.getTagHandlerPool(getServletConfig());
  }

  public void _jspDestroy() {
    _005fjspx_005ftagPool_005fc_005fset_0026_005fvar_005fvalue_005fnobody.release();
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
      throws java.io.IOException, javax.servlet.ServletException {

    final java.lang.String _jspx_method = request.getMethod();
    if (!"GET".equals(_jspx_method) && !"POST".equals(_jspx_method) && !"HEAD".equals(_jspx_method) && !javax.servlet.DispatcherType.ERROR.equals(request.getDispatcherType())) {
      response.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, "JSPs only permit GET POST or HEAD");
      return;
    }

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write('\r');
      out.write('\n');
      out.write("<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">");
      out.write("\r\n");
      out.write("\r\n");
      out.write("<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n");
      out.write("<head>\r\n");
      out.write("<title>门诊收费</title>\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      if (_jspx_meth_c_005fset_005f0(_jspx_page_context))
        return;
      out.write('\r');
      out.write('\n');
      if (_jspx_meth_c_005fset_005f1(_jspx_page_context))
        return;
      out.write("\r\n");
      out.write("<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\r\n");
      out.write("<meta http-equiv=\"X-UA-Compatible\" content=\"IE=EmulateIE8\" />\r\n");
      out.write("\r\n");
      out.write("<script src=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/scripts/boot.js\" type=\"text/javascript\"></script>\r\n");
      out.write("<script type=\"text/javascript\" src=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/commons/dynamic.jsp\"></script>\r\n");
      out.write("\r\n");
      out.write("<script type=\"text/javascript\" src=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/scripts/core.js\"></script>\r\n");
      out.write("<script type=\"text/javascript\" src=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/scripts/plugins/template/jquery.tmpl.min.js\"></script>\r\n");
      out.write("\r\n");
      out.write("<link href=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/styles/default/css/web.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("<script src=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/scripts/plugins/report/CreateControl.js\" type=\"text/javascript\"></script>\r\n");
      out.write("<style type=\"text/css\">\r\n");
      out.write("\t.required {\r\n");
      out.write("\t\tcolor:#006aad;\r\n");
      out.write("\t}\r\n");
      out.write("\t.form-label {\r\n");
      out.write("\t\ttext-align:right;\r\n");
      out.write("\t\twidth:60px;\r\n");
      out.write("\t}\r\n");
      out.write("\t.blue-weight {\r\n");
      out.write("\t\tfont-size:14px;\r\n");
      out.write("\t\tcolor:#006aad;\r\n");
      out.write("\t\tfont-weight:bold;\r\n");
      out.write("\t}\r\n");
      out.write("\t.myrow\r\n");
      out.write("    {\r\n");
      out.write("        background-color:#94ec94;\r\n");
      out.write("    }\r\n");
      out.write("\t.mycell\r\n");
      out.write("    {\r\n");
      out.write("        font-weight:bold;\r\n");
      out.write("    }\r\n");
      out.write("    .mini-splitter .mini-splitter-pane1{\r\n");
      out.write("    \tborder:0;\r\n");
      out.write("    \tborder-bottom:#8C8C8C solid 1px;\r\n");
      out.write("    }\r\n");
      out.write("</style>\r\n");
      out.write("<script type=\"text/javascript\">\r\n");
      out.write("\r\n");
      out.write("\t// 打印发票\r\n");
      out.write("\tfunction btnPrint_onclick(r) {\r\n");
      out.write("\t\tvar report = document.getElementById(\"Report\");\r\n");
      out.write("\t\treport.LoadFromURL(\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/report/template/opExpReceipt.grf?t=\"+new Date().getTime());\r\n");
      out.write("\t\t\r\n");
      out.write("\t\treport.ParameterByName(\"registerDeptName\").AsString = r.registerDeptName;\r\n");
      out.write("\t\treport.ParameterByName(\"invoiceNo\").AsString = r.invoiceNo;\r\n");
      out.write("\t\treport.ParameterByName(\"patientName\").AsString = r.patientName;\r\n");
      out.write("\t\treport.ParameterByName(\"receiptTime\").AsString = r.receiptTime;\r\n");
      out.write("\t\tif(r.drugWindow) {\r\n");
      out.write("\t\t\treport.ParameterByName(\"drugWindow\").AsString = r.drugWindow;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\treport.ParameterByName(\"ownCost\").AsString = r.ownCost;\r\n");
      out.write("\t\treport.ParameterByName(\"upperOwnCost\").AsString = r.upperOwnCost;// 大写金额\r\n");
      out.write("\t\treport.ParameterByName(\"cashCost\").AsString = r.cashCost ? r.cashCost : \"0.00\";// 现金金额\r\n");
      out.write("\t\treport.ParameterByName(\"isManyWays\").AsString = r.isManyWays ? r.isManyWays : \" \";\r\n");
      out.write("\t\treport.ParameterByName(\"receiptOperId\").AsString = r.receiptOperId;\r\n");
      out.write("\t\t\r\n");
      out.write("\t\treport.ParameterByName(\"fee1\").AsString = r.receiptListList[0].itemStattypeName + \"  \" + r.receiptListList[0].ownCost;\r\n");
      out.write("\t\tif(r.receiptListList[1]) {\r\n");
      out.write("\t\t\treport.ParameterByName(\"fee2\").AsString = r.receiptListList[1].itemStattypeName + \"  \" + r.receiptListList[1].ownCost;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tif(r.receiptListList[2]) {\r\n");
      out.write("\t\t\treport.ParameterByName(\"fee3\").AsString = r.receiptListList[2].itemStattypeName + \"  \" + r.receiptListList[2].ownCost;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tif(r.receiptListList[3]) {\r\n");
      out.write("\t\t\treport.ParameterByName(\"fee4\").AsString = r.receiptListList[3].itemStattypeName + \"  \" + r.receiptListList[3].ownCost;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tif(r.receiptListList[4]) {\r\n");
      out.write("\t\t\treport.ParameterByName(\"fee5\").AsString = r.receiptListList[4].itemStattypeName + \"  \" + r.receiptListList[4].ownCost;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tif(r.receiptListList[5]) {\r\n");
      out.write("\t\t\treport.ParameterByName(\"fee6\").AsString = r.receiptListList[5].itemStattypeName + \"  \" + r.receiptListList[5].ownCost;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\t\r\n");
      out.write("\t\t//report.Printer.PrinterName = \"Microsoft XPS Document Writer\";\r\n");
      out.write("\t\treport.Printer.PrinterName = \"Adobe PDF\";\r\n");
      out.write("\t\treport.PrintPreview(true);// 打印预览\r\n");
      out.write("\t\t\r\n");
      out.write("//  \treport.Print(false);// false为直接打印\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t//F2切换标记\r\n");
      out.write("\tvar numFlag = 2;\r\n");
      out.write(" \t\r\n");
      out.write("\t// 键盘监听事件\r\n");
      out.write("\tdocument.onkeydown=function() {\r\n");
      out.write("\t\tif(event.keyCode == 113) {// 按F2切换检索条件\r\n");
      out.write("\t\t\tswitch(numFlag) {\r\n");
      out.write("\t\t\tcase 1:\r\n");
      out.write("\t\t\t\tdocument.getElementById('text01').innerText = '当日号';\r\n");
      out.write("\t\t\t\tnumFlag = 2 ;\r\n");
      out.write("\t\t\t\tbreak;\r\n");
      out.write("\t\t\tcase 2:\r\n");
      out.write("\t\t\t\tdocument.getElementById('text01').innerText = '唯一号';\r\n");
      out.write("\t\t\t\tnumFlag = 1 ;\r\n");
      out.write("\t\t\t\tbreak;\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\t\r\n");
      out.write("\t\tif(event.keyCode == 112) {// 按F1 打开挂号列表\r\n");
      out.write("\t\t\tregisterView();\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tif(event.keyCode == 119) {// 按F8 点击收费按钮\r\n");
      out.write("\t\t\tpreCharge();\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tif(event.keyCode == 120) {// 按F9新增手工单\r\n");
      out.write("\t\t\tmanual(0);\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tif(event.keyCode == 121) {// 按F10新增一条手工单项目\r\n");
      out.write("\t\t\taddItem();\r\n");
      out.write("\t\t}\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 按条件查询挂号信息\r\n");
      out.write("\tfunction queryOpExpRegister(e) {\r\n");
      out.write("\t\tform1.clear();// 清空页面\r\n");
      out.write("\t\tgrid1.clearRows();\r\n");
      out.write("\t\tvar key = mini.get(\"key\").getValue();\r\n");
      out.write("\t\tif(!key) {\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tswitch(numFlag) {\r\n");
      out.write("\t\tcase 1:\r\n");
      out.write("\t\t\tgetByPatientId(key);\r\n");
      out.write("\t\t\tbreak;\r\n");
      out.write("\t\tcase 2:\r\n");
      out.write("\t\t\tgetBySerialId(key);\r\n");
      out.write("\t\t\tbreak;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 根据当日号获取病人基本信息，看诊以及处方信息\r\n");
      out.write("\tfunction getBySerialId(e) {\r\n");
      out.write("\t\tif(e == null) {\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tvar url = \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/medical/outpatient/opExpRegister/getBySerialId.do\";\r\n");
      out.write("\t\tvar data = {dailySerialId : e} ;\r\n");
      out.write("\t\t$.post(url, data , function(r) {\r\n");
      out.write("\t\t\tif(r.length > 1) {\r\n");
      out.write("\t\t\t\tmini.alert(\"数据异常：根据当日号查询到多条记录\");\r\n");
      out.write("\t\t\t\treturn;\r\n");
      out.write("\t\t\t};\r\n");
      out.write("\t\t\tif(r.length <= 0) {\r\n");
      out.write("\t\t\t\treturn;\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t\tgetByRegId(r[0].registerId);\r\n");
      out.write("\t\t});\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 根据唯一号获取病人基本信息，看诊以及处方信息\r\n");
      out.write("\tfunction getByPatientId(e) {\r\n");
      out.write("\t\tif(e == null) {\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tvar url = \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/fee/outFeeCharge/getByPatientId.do\";\r\n");
      out.write("\t\tvar data = {patientId : e} ;\r\n");
      out.write("\t\t$.post(url, data , function(r) {\r\n");
      out.write("\t\t\tif(r.state == \"showRegList\") {// 弹出该患者的多条挂号记录供选择\r\n");
      out.write("\t\t\t\tgrid3.setData(r.data);\r\n");
      out.write("\t\t\t\twin1.show();\r\n");
      out.write("\t\t\t\treturn;\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t\tif(r.state == \"noPatient\") {\r\n");
      out.write("\t\t\t\tmini.alert(\"没有找到唯一号为\" + e + \"的患者信息\");\r\n");
      out.write("\t\t\t\treturn;\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t\tif(r.state == \"noReg\") {\r\n");
      out.write("\t\t\t\tmini.alert(r.errorInfo);\r\n");
      out.write("\t\t\t\treturn;\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t\tgetByRegId(r);\r\n");
      out.write("\t\t});\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 双击 挂号记录 弹框条目\r\n");
      out.write("\tfunction queryData(e) {\r\n");
      out.write("\t\twin1.hide();// 隐藏弹框\r\n");
      out.write("\t\tvar registerId = e.row.registerId;\r\n");
      out.write("\t\tgetByRegId(registerId);\r\n");
      out.write("\t}\r\n");
      out.write(" \t\r\n");
      out.write("\t// 根据门诊流水号获取信息\r\n");
      out.write("\tfunction getByRegId(e) {\r\n");
      out.write("\t\tvar url = \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/radt/opRegister/getVRegisterById.do\";\r\n");
      out.write("\t\tvar fn = function (r) {\r\n");
      out.write("\t\t\tr.type = \"yes\";\r\n");
      out.write("\t    \tr.ageNum = r.age.substring(0, r.age.length - 1);\r\n");
      out.write("\t    \tr.ageType = r.age.substring(r.age.length - 1);\r\n");
      out.write("\t    \tshowInfo(r);\r\n");
      out.write("\t\t};\r\n");
      out.write("\t\t$.post(url, {registerId: e}, fn);\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write(" \t// 回填获取的信息到主页面\r\n");
      out.write(" \tfunction showInfo (r) {\r\n");
      out.write(" \t\tif (r.type == \"yes\") {\r\n");
      out.write("    \t\tvar data = mini.decode(r);\r\n");
      out.write("    \t\tform1.setData(data); \r\n");
      out.write("    \t\tif (!r.chronicDiseaseId || r.chronicDiseaseId.isEmpty()) {\r\n");
      out.write("    \t\t\tdocument.getElementById(\"chronicDiseaseText\").innerHTML = \"无\";\r\n");
      out.write("    \t\t} else {\r\n");
      out.write("    \t\t\tdocument.getElementById(\"chronicDiseaseText\").innerHTML = chronicDiseaseId.text;\r\n");
      out.write("    \t\t};\r\n");
      out.write("    \t\tif (!r.tag.outpayRate) {\r\n");
      out.write("    \t\t\tdocument.getElementById(\"payInfo\").innerHTML = \"无\";\r\n");
      out.write("    \t\t} else {\r\n");
      out.write("    \t\t\tdocument.getElementById(\"payInfo\").innerHTML = \"自付比例：\" + r.tag.outpayRate*100 + \"%\";\r\n");
      out.write("    \t\t};\r\n");
      out.write("    \t\t\r\n");
      out.write("    \t\t$.post(\r\n");
      out.write("\t\t\t\t\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/medical/common/opDiagnose/getByRegIdAndType.do\",\r\n");
      out.write("    \t\t\t{\r\n");
      out.write("\t\t\t\t\tregisterId : registerId.value,\r\n");
      out.write("\t\t\t\t\tsysType: \"O\"\r\n");
      out.write("    \t\t\t},\r\n");
      out.write("    \t\t\tfunction (result) {\r\n");
      out.write("\t\t\t\t\tif (result.length == 0) {\r\n");
      out.write("\t\t\t\t\t\tdocument.getElementById(\"diagText\").innerHTML = \"无\";\r\n");
      out.write("\t\t\t\t\t} else if (result.length == 1) {\r\n");
      out.write("\t\t\t\t\t\tdocument.getElementById(\"diagText\").innerHTML = result[0].diagName;\r\n");
      out.write("\t\t\t\t\t} else {\r\n");
      out.write("\t\t\t\t\t\tvar text = \"\";\r\n");
      out.write("\t\t\t\t\t\tfor (var i=0;i<result.length;i++) {\r\n");
      out.write("\t\t\t\t\t\t\ttext = text + result[i].diagName + \"、\";\r\n");
      out.write("\t\t\t\t\t\t}\r\n");
      out.write("\t\t\t\t\t\ttext = text.substring(0, text.length-1);\r\n");
      out.write("\t\t\t\t\t\tdocument.getElementById(\"diagText\").innerHTML = text;\r\n");
      out.write("\t\t\t\t\t}\r\n");
      out.write("    \t\t\t}\r\n");
      out.write("    \t\t);\r\n");
      out.write("    \t\tshowItemList();// 加载费用信息\r\n");
      out.write("    \t\t\r\n");
      out.write("    \t\tisBalance();// 检查是否有未完成结算\r\n");
      out.write("    \t}\r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 加载费用信息\r\n");
      out.write(" \tfunction showItemList() {\r\n");
      out.write(" \t\turl=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/fee/outFeeCharge/getVApply.do\";\r\n");
      out.write(" \t\tvar data = ({\r\n");
      out.write("\t\t\tregisterId: registerId.value,\r\n");
      out.write("\t\t\tvalidFlag: 1,\r\n");
      out.write("\t\t\ttransFlag: 1,\r\n");
      out.write("\t\t\tbalanceFlag: 0\r\n");
      out.write("\t\t});\r\n");
      out.write(" \t\t//grid1.load(data);\r\n");
      out.write(" \t\t$.post(url, data , function(r) {\r\n");
      out.write(" \t\t\tgrid1.setData(r);\r\n");
      out.write(" \t\t\tshowNoStock();// 提示无库存药品名称\r\n");
      out.write(" \t\t\t\r\n");
      out.write(" \t\t\tsetComb();// 显示组合标记\r\n");
      out.write("    \t\tgrid1.groupBy(\"orderBillId\", \"asc\");// 按处方号分组\r\n");
      out.write("\t\t});  \r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 费用列表加载完成后，显示组合标记\r\n");
      out.write(" \tfunction setComb() {\r\n");
      out.write(" \t\tvar data = grid1.getList();\r\n");
      out.write(" \t\tvar hist = {};\r\n");
      out.write("\t\tfor ( var index in data) {\r\n");
      out.write("\t\t\tvar row = data[index];\r\n");
      out.write("\t\t\tif (hist[row.orderCombId]) {\r\n");
      out.write("\t\t\t\thist[row.orderCombId].push(index);\r\n");
      out.write("\t\t\t} else {\r\n");
      out.write("\t\t\t\tif (row.orderCombId) {\r\n");
      out.write("\t\t\t\t\thist[row.orderCombId] = [ index ];\r\n");
      out.write("\t\t\t\t}\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tfor ( var it in hist) {\r\n");
      out.write("\t\t\tif (hist[it].length > 1) {\r\n");
      out.write("\t\t\t\tvar ary = hist[it];\r\n");
      out.write("\t\t\t\tary[ary.length - 1];\r\n");
      out.write("\t\t\t\tgrid1.updateRow(data[ary[0]], {\r\n");
      out.write("\t\t\t\t\tcomb : \"┑\"\r\n");
      out.write("\t\t\t\t});\r\n");
      out.write("\t\t\t\tfor (var i = 1; i < ary.length - 1; i++) {\r\n");
      out.write("\t\t\t\t\tgrid1.updateRow(data[ary[i]], {\r\n");
      out.write("\t\t\t\t\t\tcomb : \"┆\"\r\n");
      out.write("\t\t\t\t\t});\r\n");
      out.write("\t\t\t\t}\r\n");
      out.write("\t\t\t\tgrid1.updateRow(data[ary[ary.length - 1]], {\r\n");
      out.write("\t\t\t\t\tcomb : \"┙\"\r\n");
      out.write("\t\t\t\t});\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tgrid1.accept();\r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 挂号列表(页面)\r\n");
      out.write(" \tfunction registerView () {\r\n");
      out.write(" \t\tmini.open({\r\n");
      out.write("            url: \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/fee/outFeeCharge/register.do\",\r\n");
      out.write("            title: \"当日挂号记录\", \r\n");
      out.write("            width: 1200, \r\n");
      out.write("            height: 500,\r\n");
      out.write("            ondestroy: function (r) {\r\n");
      out.write("            \tshowInfo(r);\r\n");
      out.write("            \tgrid1.focus();\r\n");
      out.write("        \t} \r\n");
      out.write("        }); \r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 加号(页面)\r\n");
      out.write(" \tfunction appendView () {\r\n");
      out.write(" \t\tmini.open({\r\n");
      out.write("            url: \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/fee/outFeeCharge/append.do\",\r\n");
      out.write("            title: \"加号\", \r\n");
      out.write("            width: 760, \r\n");
      out.write("            height: 400,\r\n");
      out.write("            ondestroy: function (r) {\r\n");
      out.write("            \tif (r.state == \"ok\") {\r\n");
      out.write("            \t\trefresh();\r\n");
      out.write("            \t\tgetByRegId(r.registerId);\r\n");
      out.write("            \t\ttop.mini.alert(\"挂号成功\");\r\n");
      out.write("            \t}\r\n");
      out.write("        \t} \r\n");
      out.write("        });\r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 修改信息(页面)\r\n");
      out.write(" \tfunction updateInfoView () {\r\n");
      out.write(" \t\tif(!registerId.value) {\r\n");
      out.write(" \t\t\tmini.showTips({content:\"请先检索出患者信息\",state:\"warning\",x:\"center\",y:\"center\",timeout:3000});\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write(" \t\t}\r\n");
      out.write(" \t\t\r\n");
      out.write(" \t\tmini.open({\r\n");
      out.write("            url: \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/fee/outFeeCharge/updateInfo.do?registerId=\" + registerId.value,\r\n");
      out.write("            title: \"修改信息\", \r\n");
      out.write("            width: 480, \r\n");
      out.write("            height: 320,\r\n");
      out.write("            ondestroy: function (r) {\r\n");
      out.write("            \tshowInfo(r);\r\n");
      out.write("        \t} \r\n");
      out.write("        });\r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 计算器(页面)\r\n");
      out.write(" \tfunction calculatorView () {\r\n");
      out.write(" \t\tmini.open({\r\n");
      out.write("            url: \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/fee/outFeeCharge/calculator.do\",\r\n");
      out.write("            title: \"计算器\", \r\n");
      out.write("            width: 650, \r\n");
      out.write("            height: 280\r\n");
      out.write("        });\r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 发票累计(页面)\r\n");
      out.write(" \tfunction receiptView () {\r\n");
      out.write(" \t\tmini.open({\r\n");
      out.write("            url: \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/fee/outFeeCharge/receipt.do\",\r\n");
      out.write("            title: \"发票累计\", \r\n");
      out.write("            width: 1000, \r\n");
      out.write("            height: 400\r\n");
      out.write("        }); \r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 清空\r\n");
      out.write("\tfunction refresh () {\r\n");
      out.write(" \t\tform1.clear();\r\n");
      out.write("\t\tgrid1.clearRows();\r\n");
      out.write("\t\tgrid2.clearRows();\r\n");
      out.write("\t\tgrid3.clearRows();\r\n");
      out.write("\t\tdocument.getElementById(\"diagText\").innerHTML = \"无\";\r\n");
      out.write("\t\tdocument.getElementById(\"chronicDiseaseText\").innerHTML = \"无\";\r\n");
      out.write("\t\tdocument.getElementById(\"payInfo\").innerHTML = \"无\";\r\n");
      out.write("\t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 打开门慢信息(页面)\r\n");
      out.write(" \tfunction openChronicInfo () {\r\n");
      out.write(" \t\tif (!registerId.value) {\r\n");
      out.write(" \t\t\treturn;\r\n");
      out.write(" \t\t}\r\n");
      out.write(" \t\tmini.open({\r\n");
      out.write("            url: \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/fee/outFeeCharge/chronicInfo.do?registerId=\" + registerId.value,\r\n");
      out.write("            title: \"请选择门慢信息\", \r\n");
      out.write("            width: 520, \r\n");
      out.write("            height: 400,\r\n");
      out.write("            ondestroy: function (r) {\r\n");
      out.write("            \tshowInfo(r);\r\n");
      out.write("        \t} \r\n");
      out.write("        }); \r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 收费前验证当前患者是否有未完成的结算\r\n");
      out.write(" \tfunction preCharge() {\r\n");
      out.write(" \t\tif(!registerId.value) {\r\n");
      out.write(" \t\t\tmini.showTips({content:\"请选择患者\",state:\"warning\",x:\"center\",y:\"center\",timeout:3000});\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write(" \t\t}\r\n");
      out.write(" \t\tvar url = \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/opExpBalance/isBalance.do\";\r\n");
      out.write(" \t\tvar data = ({\r\n");
      out.write("\t\t\tregisterId: registerId.value,\r\n");
      out.write("\t\t\tvalidFlag: 1,\r\n");
      out.write("\t\t\tbalanceState: 0\r\n");
      out.write("\t\t});\r\n");
      out.write(" \t\t$.post(url, data , function(r) {\r\n");
      out.write(" \t\t\tif(r.state == \"ok\") {\r\n");
      out.write(" \t\t\t\ttoCharge();\r\n");
      out.write(" \t\t\t} else if(r.state == \"error\") {\r\n");
      out.write("\t\t\t\tmini.alert(r.errorText);\r\n");
      out.write("\t\t\t\treturn;\r\n");
      out.write("\t\t\t} else if(r.state == \"confirm\") {\r\n");
      out.write("\t\t\t\tmini.confirm(r.errorText, \"提示\",\r\n");
      out.write("\t\t\t            function (action) {\r\n");
      out.write("\t\t\t                if (action == \"ok\") {\r\n");
      out.write("\t\t\t                \tpayInfoView(r);\r\n");
      out.write("\t\t\t                } else {\r\n");
      out.write("\t\t\t                \treturn;\r\n");
      out.write("\t\t\t                }\r\n");
      out.write("\t\t\t            }\r\n");
      out.write("\t\t\t        );\r\n");
      out.write("\t\t\t} else {\r\n");
      out.write("\t\t\t\tmini.alert(r);\r\n");
      out.write("\t\t\t\treturn;\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t});  \r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 执行收费前验证\r\n");
      out.write(" \tfunction toCharge() {\r\n");
      out.write(" \t\tvar rows = grid1.getList();\r\n");
      out.write("\t\tif(rows.length <= 0) {\r\n");
      out.write("\t\t\tmini.showTips({content:\"不存在收费项目\",state:\"warning\",x:\"center\",y:\"center\",timeout:3000});\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\t\r\n");
      out.write("\t\t// 获取勾选项目条数\r\n");
      out.write("\t\tvar num = 0;\r\n");
      out.write("\t\tfor(var i = 0 ; i < rows.length ; i++) {\r\n");
      out.write("\t\t\t// 验证 收费数量 是否填写正确\r\n");
      out.write("\t\t\tvar reg = /^[1-9][0-9]*$/ ;  \r\n");
      out.write("\t\t\tif(rows[i].dataSource == 0 && !reg.test(rows[i].showQty)) {\r\n");
      out.write("\t\t\t\tmini.showTips({content:\"请检查手工单录入的收费数量是否正确\",state:\"warning\",x:\"center\",y:\"center\",timeout:3000});\r\n");
      out.write("\t\t\t\treturn;\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t\t\r\n");
      out.write("\t\t\tif(rows[i].checkFlag == 1) {\r\n");
      out.write("\t\t\t\tnum++;\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tif(num == 0) {\r\n");
      out.write("\t\t\tmini.showTips({content:\"没有任何项目被选中\",state:\"warning\",x:\"center\",y:\"center\",timeout:3000});\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tif(num < rows.length) {\r\n");
      out.write("\t\t\tmini.confirm(\"患者还存在未勾选的处方信息，是否继续收费？\", \"提示\",\r\n");
      out.write("\t\t            function (action) {\r\n");
      out.write("\t\t                if (action == \"ok\") {\r\n");
      out.write("\t\t                \tcharge(rows);\r\n");
      out.write("\t\t                \treturn;\r\n");
      out.write("\t\t                } else {\r\n");
      out.write("\t\t                    return;\r\n");
      out.write("\t\t                }\r\n");
      out.write("\t\t            }\r\n");
      out.write("\t\t        );\r\n");
      out.write("\t\t} else {\r\n");
      out.write("\t\t\tcharge(rows);\r\n");
      out.write("\t\t}\r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 验证当前患者是否有未完成的结算\r\n");
      out.write(" \tfunction isBalance() {\r\n");
      out.write(" \t\tvar url = \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/opExpBalance/isBalance.do\";\r\n");
      out.write(" \t\tvar data = ({\r\n");
      out.write("\t\t\tregisterId: registerId.value,\r\n");
      out.write("\t\t\tvalidFlag: 1,\r\n");
      out.write("\t\t\tbalanceState: 0\r\n");
      out.write("\t\t});\r\n");
      out.write(" \t\t$.post(url, data , function(r) {\r\n");
      out.write(" \t\t\tif(r.state == \"ok\") {\r\n");
      out.write(" \t\t\t\treturn;\r\n");
      out.write(" \t\t\t} else if(r.state == \"error\") {\r\n");
      out.write("\t\t\t\tmini.alert(r.errorText);\r\n");
      out.write("\t\t\t\treturn;\r\n");
      out.write("\t\t\t} else if(r.state == \"confirm\") {\r\n");
      out.write("\t\t\t\tmini.confirm(r.errorText, \"提示\",\r\n");
      out.write("\t\t\t            function (action) {\r\n");
      out.write("\t\t\t                if (action == \"ok\") {\r\n");
      out.write("\t\t\t                \tpayInfoView(r);\r\n");
      out.write("\t\t\t                } else {\r\n");
      out.write("\t\t\t                \treturn;\r\n");
      out.write("\t\t\t                }\r\n");
      out.write("\t\t\t            }\r\n");
      out.write("\t\t\t        );\r\n");
      out.write("\t\t\t} else {\r\n");
      out.write("\t\t\t\tmini.alert(r);\r\n");
      out.write("\t\t\t\treturn;\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t});  \r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 准备弹出\"选择支付方式\"弹框\r\n");
      out.write(" \tfunction charge(e) {\r\n");
      out.write(" \t\tvar data = {\r\n");
      out.write(" \t\t\tjson : mini.encode(e),\r\n");
      out.write(" \t\t\tregisterId: registerId.value\r\n");
      out.write(" \t\t};\r\n");
      out.write(" \t\tvar url = \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/opExpBalance/charge.do\";\r\n");
      out.write(" \t\t$.post(url, data , function(r) {\r\n");
      out.write(" \t\t\tif(r.state == 1) {\r\n");
      out.write(" \t\t\t\t// 打开支付弹框.....\r\n");
      out.write(" \t\t\t\tpayInfoView(r);\r\n");
      out.write(" \t\t\t} else {\r\n");
      out.write(" \t\t\t\ttop.mini.error(r);\r\n");
      out.write(" \t\t\t}\r\n");
      out.write(" \t\t});\r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 选择支付方式(弹框)\r\n");
      out.write(" \tfunction payInfoView(e) {\r\n");
      out.write(" \t\tvar invoiceNo = receiptNo.defaultValue;\r\n");
      out.write("\t\tmini.open({\r\n");
      out.write("            url: \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/fee/outFeeCharge/payInfo.do?registerId=\" + registerId.value + \"&balanceId=\" + e.balanceId + \"&invoiceNo=\" + invoiceNo,\r\n");
      out.write("            width: 700, \r\n");
      out.write("            height: 500,\r\n");
      out.write("            title: \"收费\", \r\n");
      out.write("            onload: function () {      \r\n");
      out.write("            },\r\n");
      out.write("            ondestroy: function (r) {\r\n");
      out.write("            \tif (r.type == \"ok\") {// 确定\r\n");
      out.write("            \t\tvar data = {\r\n");
      out.write("                \t\t\tregisterId : registerId.getValue(),\r\n");
      out.write("                \t\t\tbalanceId : e.balanceId,\r\n");
      out.write("                \t\t\tpaymentList : r.paymentList\r\n");
      out.write("                \t\t};\r\n");
      out.write("            \t\t$.post(\r\n");
      out.write("            \t\t\t\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/opExpBalance/sure.do\",\r\n");
      out.write("            \t\t\tdata,\r\n");
      out.write("            \t\t\tfunction (r) {\r\n");
      out.write("            \t\t\t\tif (r.state == \"ok\") {\r\n");
      out.write("//    \t           \t\t\t\t\ttop.mini.alert(\"收费成功\");\r\n");
      out.write("   \t           \t\t\t\t\tmini.showTips({content:\"收费成功\",state:\"success\",x:\"center\",y:\"center\",timeout:3000});\r\n");
      out.write("//    \t           \t\t\t\t\trefresh();\r\n");
      out.write("   \t           \t\t\t\t\twindow.location.reload();\r\n");
      out.write("   \t           \t\t\t\t\tbtnPrint_onclick(r);// 打印门诊收据\r\n");
      out.write("   \t           \t\t\t\t} else {\r\n");
      out.write("   \t           \t\t\t\t\ttop.mini.error(r);\r\n");
      out.write("   \t           \t\t\t\t}\r\n");
      out.write("            \t\t\t}\r\n");
      out.write("            \t\t);\r\n");
      out.write("            \t}\r\n");
      out.write("            \tif (r.type == \"cancel\") {// 取消\r\n");
      out.write("            \t\tvar data = {\r\n");
      out.write("            \t\t\tregisterId : registerId.getValue(),\r\n");
      out.write("            \t\t\tbalanceId : e.balanceId\r\n");
      out.write("            \t\t};\r\n");
      out.write("            \t\t$.post(\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/opExpBalance/cancel.do\",\r\n");
      out.write("                \t\tdata,\r\n");
      out.write("               \t\t\tfunction (r) {\r\n");
      out.write("               \t\t\t\tif (r == \"ok\") {\r\n");
      out.write("      \t           \t\t\t\t\trefresh();\r\n");
      out.write("      \t           \t\t\t\t} else {\r\n");
      out.write("      \t           \t\t\t\t\ttop.mini.error(r);\r\n");
      out.write("      \t           \t\t\t\t}\r\n");
      out.write("               \t\t\t}\r\n");
      out.write("               \t\t);\r\n");
      out.write("            \t}\r\n");
      out.write("        \t} \r\n");
      out.write("        }); \r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 费用信息表的名称渲染\r\n");
      out.write(" \tfunction drugNameRenderer (e) {\r\n");
      out.write(" \t\tvar itemName = e.row.itemName;\r\n");
      out.write(" \t\tvar specs = e.row.specs;\r\n");
      out.write(" \t\tif(itemName == null || itemName ==\"\") {\r\n");
      out.write(" \t\t\treturn \"\";\r\n");
      out.write(" \t\t}\r\n");
      out.write(" \t\tif(!specs) {\r\n");
      out.write(" \t\t\tspecs = \"\";\r\n");
      out.write(" \t\t}\r\n");
      out.write(" \t\treturn itemName + \" {\" + specs + \"}\";\r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 费用信息表的单价渲染\r\n");
      out.write(" \tfunction priceRenderer (e) {\r\n");
      out.write(" \t\tvar price = e.row.price;\r\n");
      out.write(" \t\tvar drugPackageUnit = e.row.drugPackageUnit;\r\n");
      out.write(" \t\tif(price == null) {\r\n");
      out.write(" \t\t\treturn \"\";\r\n");
      out.write(" \t\t}\r\n");
      out.write(" \t\tif (!drugPackageUnit) {\r\n");
      out.write(" \t\t\treturn price;\r\n");
      out.write(" \t\t}\r\n");
      out.write(" \t\treturn price + \"/\" + drugPackageUnit;\r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write("\t// 生成电子单  \r\n");
      out.write(" \tfunction onDrawGroup(e) { \r\n");
      out.write("\t\tvar text;\r\n");
      out.write("\t\tvar text2;\r\n");
      out.write("\t\tif( e.rows[0].dataSourceWay == 0 && e.rows[0].dataSource == 0 ) {\r\n");
      out.write("\t\t\tif (e.rows[0].itemSysType == \"HR\") {\r\n");
      out.write("\t\t\t\ttext = \"<span style='color:#006aad;font-size:10pt;'> \" + \"草药单：\";\r\n");
      out.write("\t\t\t\ttext2 = \"付数：\";\r\n");
      out.write("\t\t\t\te.cellHtml = text + e.value + \"&emsp;&emsp;医生：\" + e.rows[0].recipeDoctName + \"&emsp;&emsp;科室：\" + e.rows[0].recipeDeptName + \"</span>\";\r\n");
      out.write("\t\t\t} else {\r\n");
      out.write("\t\t\t\ttext = \"<span style='color:#006aad;font-size:10pt;'> \" + \"手工单：\";\r\n");
      out.write("\t\t\t\te.cellHtml = text + e.value + \"&emsp;&emsp;医生：\" + e.rows[0].recipeDoctName + \"&emsp;&emsp;科室：\" + e.rows[0].recipeDeptName + \"</span>\";\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t} else {\r\n");
      out.write("\t\t\ttext = \"<span style='color:#006aad;font-size:10pt;'> \" + \"电子单：\";\r\n");
      out.write("\t\t\te.cellHtml = text + e.value + \"&emsp;&emsp;医生：\" + e.rows[0].recipeDoctName + \"&emsp;&emsp;科室：\" + e.rows[0].recipeDeptName + \"</span>\";\r\n");
      out.write("\t\t}\r\n");
      out.write("    }\r\n");
      out.write(" \t\r\n");
      out.write("\t// 鼠标右键菜单\r\n");
      out.write("\tfunction onBeforeOpen(e) {\r\n");
      out.write("\t    var menu = e.sender;\r\n");
      out.write("\t    e.htmlEvent.preventDefault();\r\n");
      out.write("\t    e.cancel = false;\r\n");
      out.write("\t}\r\n");
      out.write(" \t\r\n");
      out.write(" \tvar num = 1;// 手工单数量\r\n");
      out.write(" \t// 打开手工单编辑弹框\r\n");
      out.write(" \tfunction manual(e) {\r\n");
      out.write(" \t\tvar text;\r\n");
      out.write(" \t\tif(e == 0) {// 新增\r\n");
      out.write(" \t\t\ttext = \"新增\";\r\n");
      out.write(" \t\t\tif(!registerId.getValue()) {// 提示先回填挂号信息\r\n");
      out.write(" \t\t\t\tmini.showTips({content:\"请先检索出挂号信息\",state:\"warning\",x:\"center\",y:\"center\",timeout:3000});\r\n");
      out.write(" \t \t\t\treturn;\r\n");
      out.write(" \t\t\t}\r\n");
      out.write(" \t\t}\r\n");
      out.write(" \t\tvar row;\r\n");
      out.write(" \t\tif(e == 1) {// 修改\r\n");
      out.write(" \t\t\trow = grid1.getSelected();\r\n");
      out.write(" \t \t\tif(!row || row.billType == 3) {\r\n");
      out.write(" \t \t\t\tmini.showTips({content:\"请选中一条手工单项目\",state:\"warning\",x:\"center\",y:\"center\",timeout:3000});\r\n");
      out.write(" \t \t\t\treturn;\r\n");
      out.write(" \t \t\t}\r\n");
      out.write(" \t\t\ttext = \"修改\";\r\n");
      out.write(" \t\t}\r\n");
      out.write(" \t\tmini.open({\r\n");
      out.write("            url: \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/fee/outFeeCharge/manual.do\",\r\n");
      out.write("            title: text + \"手工单\", \r\n");
      out.write("            width: 350, \r\n");
      out.write("            height: 400,\r\n");
      out.write("            onload: function () {      \r\n");
      out.write("                var iframe = this.getIFrameEl();\r\n");
      out.write("                var data = {\r\n");
      out.write("                \toperType : e,// 操作类型：0新增，1修改\r\n");
      out.write("                \tseeDoctId : seeDoctId.getValue(),\r\n");
      out.write("                \tseeDeptId : seeDeptId.getValue(),\r\n");
      out.write("                \tregisterDoctId : registerDoctId.getValue(),\r\n");
      out.write("                \tregisterDeptId : registerDeptId.getValue(),\r\n");
      out.write("                };\r\n");
      out.write("                iframe.contentWindow.setData(data);\r\n");
      out.write("            },\r\n");
      out.write("            ondestroy: function (r) {\r\n");
      out.write("            \tif (r.type == \"ok\" && e == 0) {// 新增\r\n");
      out.write("            \t\tvar newRow = {\r\n");
      out.write("            \t\t\tbillType : r.billType,\r\n");
      out.write("            \t\t\torderBillId\t: r.orderBillId,\r\n");
      out.write("            \t\t\trecipeDoctId : r.doctId,\r\n");
      out.write("            \t\t\trecipeDeptId : r.roomId,\r\n");
      out.write("            \t\t\trecipeDoctName : r.recipeDoctName,\r\n");
      out.write("            \t\t\trecipeDeptName : r.recipeDeptName,\r\n");
      out.write("            \t\t\tdataSourceWay : 0,// 手工记账\r\n");
      out.write("         \t\t\t\tdataSource : 0, // 数据来源 : 操作员\r\n");
      out.write("         \t\t\t\titemSysType : r.billType == \"2\" ? \"HR\" : \"\"\r\n");
      out.write("            \t\t};\r\n");
      out.write("            \t\taddRow(newRow);\r\n");
      out.write("            \t\tgrid1.setSelected(newRow);\r\n");
      out.write("                \tgrid1.beginEditCell(grid1.getSelected(), \"itemId\");\r\n");
      out.write("            \t}\r\n");
      out.write("            \tif (r.type == \"ok\" && e == 1) {// 修改\r\n");
      out.write("            \t\tvar rows = grid1.getList();// 获取页面所有行\r\n");
      out.write("            \t\tfor(var i = 0 ; i < rows.length ; i++) {\r\n");
      out.write("            \t\t\tif(rows[i].orderBillId == row.orderBillId) {// 更新选中处方单信息\r\n");
      out.write("            \t\t\t\tgrid1.updateRow(rows[i],{\r\n");
      out.write("                    \t\t\tbillType : r.billType,\r\n");
      out.write("                    \t\t\trecipeDoctId : r.doctId,\r\n");
      out.write("                    \t\t\trecipeDeptId : r.roomId,\r\n");
      out.write("                    \t\t\trecipeDoctName : r.recipeDoctName,\r\n");
      out.write("                    \t\t\trecipeDeptName : r.recipeDeptName,\r\n");
      out.write("                    \t\t\tdataSourceWay : 0,// 手工记账\r\n");
      out.write("                 \t\t\t\tdataSource : 0 // 数据来源 : 操作员\r\n");
      out.write("                    \t\t});\r\n");
      out.write("            \t\t\t}\r\n");
      out.write("            \t\t}\r\n");
      out.write("            \t\tgrid1.groupBy(\"orderBillId\");\r\n");
      out.write("            \t}\r\n");
      out.write("        \t} \r\n");
      out.write("        });\r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 往处方中新增一条项目\r\n");
      out.write(" \tfunction addItem(e) {\r\n");
      out.write(" \t\tvar row = grid1.getSelected();\r\n");
      out.write(" \t\tif(!row) {\r\n");
      out.write(" \t\t\treturn;\r\n");
      out.write(" \t\t}\r\n");
      out.write(" \t\tif(row.dataSourceWay != 0 || row.dataSource != 0) {\r\n");
      out.write(" \t\t\tmini.showTips({content:\"电子单无法修改\",state:\"warning\",x:\"center\",y:\"center\",timeout:3000});\r\n");
      out.write(" \t\t\treturn;\r\n");
      out.write(" \t\t}\r\n");
      out.write(" \t\t\r\n");
      out.write(" \t\t// 如果界面中有未完成编辑的新增行，则不允许新增，同时定位到未完成行\r\n");
      out.write(" \t\tvar rows = grid1.getList();\r\n");
      out.write("\t\tvar reg = /^[1-9][0-9]*$/ ;\r\n");
      out.write("\t\t// 验证 是否有未完成编辑行\r\n");
      out.write("\t\tfor(var i = 0 ; i < rows.length ; i++) {\r\n");
      out.write("\t\t\tif(rows[i].dataSource == 0) {\r\n");
      out.write("\t\t\t\tif(!rows[i].itemId || !rows[i].itemName || !reg.test(rows[i].showQty) || !rows[i].showUnit) {\r\n");
      out.write("\t\t\t\t\tgrid1.setSelected(rows[i]);\r\n");
      out.write("\t\t\t\t\tgrid1.beginEditCell(rows[i], \"itemId\");// \r\n");
      out.write("\t\t\t\t\treturn;\r\n");
      out.write("\t\t\t\t}\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t}\r\n");
      out.write(" \t\t\r\n");
      out.write(" \t\tvar newRow = {\r\n");
      out.write(" \t\t\t\tbillType : row.billType , \r\n");
      out.write(" \t\t\t\torderBillId : row.orderBillId,\r\n");
      out.write(" \t\t\t\trecipeDoctId : row.recipeDoctId,\r\n");
      out.write("    \t\t\trecipeDeptId : row.recipeDeptId,\r\n");
      out.write("    \t\t\trecipeDoctName : row.recipeDoctName,\r\n");
      out.write("    \t\t\trecipeDeptName : row.recipeDeptName,\r\n");
      out.write("    \t\t\titemSysType : row.itemSysType,// 划价项目新增时判断是不是草药单\r\n");
      out.write(" \t\t\t\titemName : \"\",\r\n");
      out.write(" \t\t\t\tprice : \"\",\r\n");
      out.write(" \t\t\t\tdataSourceWay : 0,// 手工记账\r\n");
      out.write(" \t\t\t\tdataSource : 0 // 数据来源 : 操作员\r\n");
      out.write(" \t\t};\r\n");
      out.write(" \t\t\r\n");
      out.write("    \taddRow(newRow);\r\n");
      out.write("\t\tif(e != \"2\") {// 通过回车键添加新行时，只有通过此方式才能选中新增行\r\n");
      out.write("\t\t\tgrid1.setSelected(newRow);\r\n");
      out.write("\t\t\tgrid1.beginEditCell(grid1.getSelected(), \"itemId\");\r\n");
      out.write("\t\t}\r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 手工单添加一行\r\n");
      out.write(" \tfunction addRow(newRow) {\r\n");
      out.write(" \t\tgrid1.addRow(newRow);\r\n");
      out.write(" \t\tgrid1.groupBy(\"orderBillId\");\r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 删除手工单项目\r\n");
      out.write(" \tfunction removeItem() {\r\n");
      out.write(" \t\tvar row = grid1.getSelected();\r\n");
      out.write(" \t\tif(!row) {\r\n");
      out.write(" \t\t\treturn;\r\n");
      out.write(" \t\t}\r\n");
      out.write(" \t\t//if(row.billType == 3) {// 电子单不允许删除\r\n");
      out.write(" \t\tif(row.dataSourceWay != 0 || row.dataSource != 0) {\r\n");
      out.write(" \t\t\tmini.showTips({content:\"电子单不允许进行删除操作\",state:\"warning\",x:\"center\",y:\"center\",timeout:3000});\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t}\r\n");
      out.write(" \t\tif(row.applyId && row.applyId > 0) {\r\n");
      out.write(" \t\t\tvar ids = [];\r\n");
      out.write(" \t\t\tids.push(row.applyId);\r\n");
      out.write(" \t\t\tvar rows = [row];\r\n");
      out.write(" \t\t\tvar data = {\r\n");
      out.write("\t \t\t\tapplyIds : ids.join(\",\"),\r\n");
      out.write("\t \t\t\tbalanceFlag : 0\r\n");
      out.write("\t \t\t}\r\n");
      out.write(" \t\t\tdeleManul(data,rows);\r\n");
      out.write(" \t\t} else {\r\n");
      out.write(" \t\t\tgrid1.removeRow(row);\r\n");
      out.write(" \t\t}\r\n");
      out.write(" \t\tgrid1.groupBy(\"orderBillId\");\r\n");
      out.write(" \t}\r\n");
      out.write(" \t\t\r\n");
      out.write(" \t// 删除一条已经划价的手工单项目\r\n");
      out.write(" \tfunction deleManul(e,rows) {\r\n");
      out.write(" \t\tvar url = \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/opExpApply/delManul.do\";\r\n");
      out.write(" \t\tvar fn = function(r) {\r\n");
      out.write("\t\t\tif (r == \"ok\") {\r\n");
      out.write("\t\t\t\tfor(var i = 0 ; i < rows.length ; i++) {\r\n");
      out.write("\t\t\t\t\tgrid1.removeRow(rows[i]);\r\n");
      out.write("\t\t\t\t}\r\n");
      out.write("\t\t\t\tgrid1.groupBy(\"orderBillId\");\r\n");
      out.write("\t\t\t\treturn;\r\n");
      out.write("\t\t\t} else {\r\n");
      out.write("\t\t\t\ttop.mini.error(r);\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\t$.post(url, e, fn);\r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 删除整个手工单\r\n");
      out.write(" \tfunction removeApply() {\r\n");
      out.write(" \t\tvar row = grid1.getSelected();\r\n");
      out.write(" \t\tif(!row) {\r\n");
      out.write(" \t\t\treturn;\r\n");
      out.write(" \t\t}\r\n");
      out.write(" \t\tif(row.dataSourceWay != 0 || row.dataSource != 0) {// 电子单不允许删除\r\n");
      out.write("\t\t\tmini.showTips({content:\"电子单不允许进行删除操作\",state:\"warning\",x:\"center\",y:\"center\",timeout:3000});\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t}\r\n");
      out.write(" \t\tmini.confirm(\"确定删除这个手工单？\",\"提示\",\r\n");
      out.write("\t\t\tfunction (action) {\r\n");
      out.write("\t\t\t\tif (action == \"ok\") {\r\n");
      out.write("\t\t\t\t\tvar rows = grid1.getList();// 获取页面所有行\r\n");
      out.write("\t\t\t\t\t\r\n");
      out.write("\t\t\t\t\tvar ids = [];// 存已划价的applyId\r\n");
      out.write("\t\t\t\t\tvar rows2 = [];// 存已划价的项目\r\n");
      out.write("\t\t\t\t\tfor(var i = 0 ; i < rows.length ; i++) {\r\n");
      out.write("\t\t\t\t\t\tif(rows[i].orderBillId == row.orderBillId) {// 删除所有与选中行单号相等的项目\r\n");
      out.write("\t\t\t\t\t\t\r\n");
      out.write("\t\t\t\t\t\t\tif(rows[i].applyId && rows[i].applyId > 0) {\r\n");
      out.write("\t\t\t\t\t \t\t\t\r\n");
      out.write("\t\t\t\t\t \t\t\tids.push(rows[i].applyId);\r\n");
      out.write("\t\t\t\t\t \t\t\trows2.push(rows[i]);\r\n");
      out.write("\t\t\t\t\t \t\t\t\r\n");
      out.write("\t\t\t\t\t \t\t} else {\r\n");
      out.write("\t\t\t\t\t \t\t\tgrid1.removeRow(rows[i]);\r\n");
      out.write("\t\t\t\t\t \t\t}\r\n");
      out.write("\t\t\t\t\t\t\r\n");
      out.write("\t\t\t\t\t\t}\r\n");
      out.write("\t\t\t\t\t}\r\n");
      out.write("\t\t\t\t\tvar data = {\r\n");
      out.write("\t\t \t\t\tapplyIds : ids.join(\",\"),\r\n");
      out.write("\t\t \t\t\tbalanceFlag : 0\r\n");
      out.write("\t\t \t\t}\r\n");
      out.write("\t \t\t\tdeleManul(data,rows2);\r\n");
      out.write("\t\t\t\t\t//grid1.groupBy(\"orderBillId\");\r\n");
      out.write("\t\t\t\t} else {\r\n");
      out.write("\t\t\t\t\treturn;\r\n");
      out.write("\t\t\t\t}\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t); \r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 单元格编辑前事件\r\n");
      out.write("\tfunction oncellbeginedit(e) {\r\n");
      out.write(" \t\tvar billType = e.row.billType ;\r\n");
      out.write(" \t\tif (billType == 1 && e.field == \"orderOnceDosage\") {// 手工单的用量不允许编辑\r\n");
      out.write("\t\t\te.cancel = true;\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t}\r\n");
      out.write(" \t\tif ( (e.row.dataSourceWay != 0 || e.row.dataSource != 0) && e.field != \"checkFlag\" ) {\r\n");
      out.write("\t\t\te.cancel = true;// 如果是电子单，不允许编辑\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t} else {\r\n");
      out.write("\t\t\te.cancel = false;\r\n");
      out.write("\t\t}\r\n");
      out.write(" \t\t\r\n");
      out.write(" \t\t// 费用类别不允许便捷\r\n");
      out.write(" \t\tif(e.field == \"itemFeeType\") {\r\n");
      out.write(" \t\t\te.cancel = true;\r\n");
      out.write(" \t\t}\r\n");
      out.write(" \t\t\r\n");
      out.write(" \t\t// 药品项目单位是否可以变更\r\n");
      out.write(" \t\t/* if (e.row.drugBulkUnit && (e.row.drugBulkUnit != e.row.drugPackageUnit) && e.field == \"showUnit\" && e.row.itemSourceType == 0) {\r\n");
      out.write("\t\t\tvar unitData = [{id: e.row.drugPackageUnit, text: e.row.drugPackageUnit},{id: e.row.drugBulkUnit, text: e.row.drugBulkUnit}]\r\n");
      out.write("\t\t\te.editor.setData(unitData);\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tif ((!e.row.drugBulkUnit || e.row.drugBulkUnit == e.row.drugPackageUnit) && e.field == \"showUnit\" && e.row.itemSourceType == 0) {\r\n");
      out.write("\t\t\te.cancel = true;\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tif (e.field == \"showUnit\" && e.row.itemSourceType == 1) {\r\n");
      out.write("\t\t\te.cancel = true;\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t} */\r\n");
      out.write(" \t\t\r\n");
      out.write("\t\tvar editor = grid1.getCellEditor(\"itemId\", e.row);\r\n");
      out.write("\t\tvar url;\r\n");
      out.write("\t\tif ( billType == 1 || (e.row.dataSourceWay == 0 && e.row.dataSource == 0 && e.row.itemSysType != \"HR\") ) {// 手工单\r\n");
      out.write("\t\t\turl=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/fee/outFeeCharge/getForManual.do?itemType1=1&registerId=\" + registerId.value;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tif ( billType == 2 || (e.row.dataSourceWay == 0 && e.row.dataSource == 0 && e.row.itemSysType == \"HR\") ) {// 草药单\r\n");
      out.write("\t\t\turl=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/fee/outFeeCharge/getForManual.do?itemType2=1&registerId=\" + registerId.value;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\teditor.load(url);\r\n");
      out.write("\t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 编辑器按回车时发生\r\n");
      out.write(" \tfunction celleditenter(e) {\r\n");
      out.write(" \t\tif(e.column.field == \"showUnit\") {\r\n");
      out.write(" \t\t\taddItem(\"2\");// 2表示通过回车新增行\r\n");
      out.write(" \t\t}\r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write("\t// 单位渲染\r\n");
      out.write("\tfunction unitRenderer (e) {\r\n");
      out.write("\t\treturn e.row.showUnit;\r\n");
      out.write("\t}\r\n");
      out.write(" \t\r\n");
      out.write("\t// 将项目编码下拉框选择的项目赋值给当前编辑行\r\n");
      out.write("\tfunction onItemChanged (e) {\r\n");
      out.write("\t\tvar currentRow = grid1.getSelected();\r\n");
      out.write("\t\tvar itemSelected = e.selected;\r\n");
      out.write("\t\tif (!currentRow || !itemSelected) {\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tif(itemSelected.executeDeptId == -1) {// 库存不足，后端约定标记-1\r\n");
      out.write("\t\t\tmini.alert(\"【\" + itemSelected.itemName + \"】库存不足\")\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tif(itemSelected.executeDeptId == 0) {// 非药品 没有默认执行科室,后端约定标记0\r\n");
      out.write("\t\t\tcurrentRow.executeDeptId = currentRow.recipeDeptId;\r\n");
      out.write("\t\t} else {\r\n");
      out.write("\t\t\tcurrentRow.executeDeptId = itemSelected.executeDeptId;// 执行科室\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tcurrentRow.specs = itemSelected.specs;\r\n");
      out.write("\t\tcurrentRow.itemName = itemSelected.itemName;\r\n");
      out.write("\t\tcurrentRow.price = itemSelected.price;\r\n");
      out.write("\t\tcurrentRow.showUnit = itemSelected.drugBulkUnit ? itemSelected.drugBulkUnit : itemSelected.unit;\r\n");
      out.write("\t\tcurrentRow.drugPackageUnit = itemSelected.unit;\r\n");
      out.write("\t\tcurrentRow.itemFeeType = itemSelected.itemFeeType;\r\n");
      out.write("\t\t//currentRow.stockDeptId = itemSelected.xxx;\r\n");
      out.write("\t\t//currentRow.xxx = itemSelected.xxx;\r\n");
      out.write("\t\tcurrentRow.itemSourceType = itemSelected.itemSourceType;\r\n");
      out.write("\t\tcurrentRow.itemSysType = itemSelected.itemSysType;\r\n");
      out.write("\t\tcurrentRow.packageFlag = itemSelected.packageFlag;\r\n");
      out.write("\t\tcurrentRow.identification = itemSelected.identification;\r\n");
      out.write("\t\tcurrentRow.checkFlag = 1;\r\n");
      out.write("\t\tcurrentRow.showQty = 1;\r\n");
      out.write("\t\tcurrentRow.drugBulkUnit = itemSelected.drugBulkUnit;\r\n");
      out.write("\t\tcurrentRow.drugPackageQty = itemSelected.drugPackageQty;\r\n");
      out.write("\t\t\r\n");
      out.write("\t\tif(currentRow.showUnit != itemSelected.unit) {// 显示单位不等于包装单位\r\n");
      out.write("\t\t\tcurrentRow.totCost = (itemSelected.price / itemSelected.drugPackageQty).toFixed(2);\r\n");
      out.write("\t\t} else {\r\n");
      out.write("\t\t\tcurrentRow.totCost = itemSelected.price.toFixed(2);\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\t\r\n");
      out.write("\t\tcurrentRow.applyId = -1;\r\n");
      out.write("\t\tcurrentRow.applyNo = \"\";\r\n");
      out.write("\t\tcurrentRow.orderId = \"\";\r\n");
      out.write("\t\tcurrentRow.storageDeptName = itemSelected.storageDeptName;\r\n");
      out.write("\t\tcurrentRow.storageQty = itemSelected.storageQty;\r\n");
      out.write("\t\tgrid1.updateRow(currentRow,currentRow);\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t//手工单根据数量以及单价计算金额\r\n");
      out.write("\tfunction getCost(e) {\r\n");
      out.write("\t\tif (e.field == \"showUnit\" || e.field == \"showQty\") {\r\n");
      out.write("\t\t\t// 验证 收费数量 是否填写正确\r\n");
      out.write("\t\t\tvar reg = /^[1-9][0-9]*$/ ;  \r\n");
      out.write("\t\t\tif(e.row.dataSource == 0 && !reg.test(e.row.showQty)) {\r\n");
      out.write("\t\t\t\tmini.showTips({content:\"收费数量必须是大于0的正整数\",state:\"warning\",x:\"center\",y:\"center\",timeout:3000});\r\n");
      out.write("\t\t\t\tgrid1.updateRow(e.row,{showQty : null,totCost : null});\r\n");
      out.write("\t\t\t\treturn;\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t\t\r\n");
      out.write("\t\t\t// 验证是否超库存(注意：库存总数量 为 散装量)\r\n");
      out.write("\t\t\tif(e.row.showUnit == e.row.drugPackageUnit) {// 显示单位为包装单位\r\n");
      out.write("\t\t\t\tvar bulkQty = e.row.showQty * e.row.drugPackageQty;\r\n");
      out.write("\t\t\t\tif(bulkQty >= e.row.storageQty) {\r\n");
      out.write("\t\t\t\t\tmini.alert(\"药品【\" + e.row.itemName + \"】在【\" + e.row.storageDeptName + \"】中的库存数量为\"\r\n");
      out.write("\t\t\t\t\t\t\t+ e.row.storageQty + e.row.drugBulkUnit + \"，请录入小于此数量的库存\");\r\n");
      out.write("\t\t\t\t\tgrid1.updateRow(e.row,{showQty : null,totCost : null});\r\n");
      out.write("\t\t\t\t\treturn;\r\n");
      out.write("\t\t\t\t}\r\n");
      out.write("\t\t\t} else {\r\n");
      out.write("\t\t\t\tif(e.row.showQty >= e.row.storageQty) {\r\n");
      out.write("\t\t\t\t\tmini.alert(\"药品【\" + e.row.itemName + \"】在【\" + e.row.storageDeptName + \"】中的库存数量为\"\r\n");
      out.write("\t\t\t\t\t\t\t+ e.row.storageQty + e.row.drugBulkUnit + \"，请录入小于此数量的库存\");\r\n");
      out.write("\t\t\t\t\tgrid1.updateRow(e.row,{showQty : null,totCost : null});\r\n");
      out.write("\t\t\t\t\treturn;\r\n");
      out.write("\t\t\t\t}\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t\t\r\n");
      out.write("\t\t\t\r\n");
      out.write("\t\t\t\r\n");
      out.write("\t\t\tvar totCost = 0;\r\n");
      out.write("\t\t\tif (!e.row.drugBulkUnit || e.row.drugBulkUnit == e.row.drugPackageUnit) {\r\n");
      out.write("\t\t\t\ttotCost = e.row.showQty * e.row.price;\r\n");
      out.write("\t\t\t} else if (e.row.drugBulkUnit && (e.row.drugBulkUnit != e.row.drugPackageUnit)) {\r\n");
      out.write("\t\t\t\tif (e.row.showUnit == e.row.drugPackageUnit) {\r\n");
      out.write("\t\t\t\t\ttotCost = e.row.showQty * e.row.price;\r\n");
      out.write("\t\t\t\t} else if (e.row.showUnit == e.row.drugBulkUnit) {\r\n");
      out.write("\t\t\t\t\ttotCost = e.row.showQty * e.row.price / e.row.drugPackageQty;\r\n");
      out.write("\t\t\t\t}\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t\tgrid1.updateRow(e.row,{totCost: totCost.toFixed(2)});\r\n");
      out.write("\t\t\t\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\t\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 计算总金额\r\n");
      out.write("\tfunction getTotCost() {\r\n");
      out.write("\t\tvar rows = grid1.getList();\r\n");
      out.write("\t\tvar totCost = parseFloat(0);\r\n");
      out.write("\t\tfor(var i = 0 ; i < rows.length ; i++) {\r\n");
      out.write("\t\t\ttotCost = totCost + parseFloat(rows[i].totCost);\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\treturn totCost.toFixed(2);\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 行单击时查询复合项目明细\r\n");
      out.write("\tfunction showPackInfo(e) {\r\n");
      out.write("\t\tgrid2.clearRows();\r\n");
      out.write("\t\tif(e.row.packageFlag == \"1\") {\r\n");
      out.write("\t\t\tvar url=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/fee/outFeeCharge/getForCharge.do\";\r\n");
      out.write("\t\t\tvar data = ({\r\n");
      out.write("\t\t\t\tpackageId : e.row.itemId,\r\n");
      out.write("\t\t\t\tvalidFlag : \"1\",\r\n");
      out.write("\t\t\t\tregisterId: registerId.value\r\n");
      out.write("\t\t\t});\r\n");
      out.write("\t \t\t$.post(url, data , function(r) {\r\n");
      out.write("\t \t\t\tgrid2.setData(r);\r\n");
      out.write("\t\t\t});  \r\n");
      out.write("\t\t} else {\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 当前科室发生变化\r\n");
      out.write("\tfunction onOrgChanged(e) {\r\n");
      out.write("\t\twindow.location.reload();\r\n");
      out.write("\t}\r\n");
      out.write("\r\n");
      out.write("\ttop.on(\"EVENT_ORG_CHANGED\", onOrgChanged);\r\n");
      out.write("\t$(window).unload(function() {\r\n");
      out.write("\t\ttop.un(\"EVENT_ORG_CHANGED\", onOrgChanged);\r\n");
      out.write("\t});\r\n");
      out.write(" \t\r\n");
      out.write("\t// 提示无库存药品名称\r\n");
      out.write("\tfunction showNoStock() {\r\n");
      out.write("\t\tvar rows = grid1.getList();\r\n");
      out.write("\t\tif(rows.length == 0) {\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tvar text = \"\";\r\n");
      out.write("\t\tvar flag = 0;\r\n");
      out.write("\t\tfor(var i = 0 ; i < rows.length ; i++) {\r\n");
      out.write("\t\t\tif(!rows[i].executeDeptId) {\r\n");
      out.write("\t\t\t\ttext = text + rows[i].itemName + \"<br/>\";\r\n");
      out.write("\t\t\t\tflag = 1;\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tif(flag == 1) {\r\n");
      out.write("\t\t\ttext = \"药品：<br/>\" + text + \"库存不足\";\r\n");
      out.write("\t\t\tmini.alert(text);\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\t//isBalance();\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 划价\r\n");
      out.write("\tfunction save() {\r\n");
      out.write("\t\tif(!registerId.value) {\r\n");
      out.write(" \t\t\tmini.showTips({content:\"请选择患者\",state:\"warning\",x:\"center\",y:\"center\",timeout:3000});\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write(" \t\t}\r\n");
      out.write("\t\tvar rows = grid1.getList();\r\n");
      out.write("\t\tif(rows.length <= 0) {\r\n");
      out.write("\t\t\tmini.showTips({content:\"没有需要划价的项目\",state:\"warning\",x:\"center\",y:\"center\",timeout:3000});\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\t// 验证 收费数量 是否填写正确\r\n");
      out.write("\t\tfor(var i = 0 ; i < rows.length ; i++) {\r\n");
      out.write("\t\t\t// 验证 收费数量 是否填写正确\r\n");
      out.write("\t\t\tvar reg = /^[1-9][0-9]*$/ ;  \r\n");
      out.write("\t\t\tif(rows[i].dataSource == 0 && !reg.test(rows[i].showQty)) {\r\n");
      out.write("\t\t\t\tmini.showTips({content:\"请检查手工单录入的收费数量是否正确\",state:\"warning\",x:\"center\",y:\"center\",timeout:3000});\r\n");
      out.write("\t\t\t\treturn;\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\t\r\n");
      out.write("\t\tmini.confirm(\"确定划价暂存？\", \"提示\",\r\n");
      out.write("            function (action) {\r\n");
      out.write("                if (action == \"ok\") {\r\n");
      out.write("                \tpreSave();\r\n");
      out.write("                } else {\r\n");
      out.write("                \treturn;\r\n");
      out.write("                }\r\n");
      out.write("            }\r\n");
      out.write("        );\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 划价前验证是否有结算\r\n");
      out.write("\tfunction preSave() {\r\n");
      out.write("\t\tvar url = \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/opExpBalance/isBalance.do\";\r\n");
      out.write(" \t\tvar data = ({\r\n");
      out.write("\t\t\tregisterId: registerId.value,\r\n");
      out.write("\t\t\tvalidFlag: 1,\r\n");
      out.write("\t\t\tbalanceState: 0\r\n");
      out.write("\t\t});\r\n");
      out.write(" \t\t$.post(url, data , function(r) {\r\n");
      out.write(" \t\t\tif(r.state == \"ok\") {\r\n");
      out.write(" \t\t\t\tpricing();\r\n");
      out.write(" \t\t\t} else if(r.state == \"error\") {\r\n");
      out.write("\t\t\t\tmini.alert(r.errorText);\r\n");
      out.write("\t\t\t\treturn;\r\n");
      out.write("\t\t\t} else if(r.state == \"confirm\") {\r\n");
      out.write("\t\t\t\tmini.confirm(r.errorText, \"提示\",\r\n");
      out.write("\t\t            function (action) {\r\n");
      out.write("\t\t                if (action == \"ok\") {\r\n");
      out.write("\t\t                \tpricing();\r\n");
      out.write("\t\t                } else {\r\n");
      out.write("\t\t                \treturn;\r\n");
      out.write("\t\t                }\r\n");
      out.write("\t\t            }\r\n");
      out.write("\t\t        );\r\n");
      out.write("\t\t\t} else {\r\n");
      out.write("\t\t\t\tmini.alert(r);\r\n");
      out.write("\t\t\t\treturn;\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t});\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 执行划价\r\n");
      out.write("\tfunction pricing() {\r\n");
      out.write("\t\tvar data = {\r\n");
      out.write(" \t\t\tjson : mini.encode(grid1.getList()),\r\n");
      out.write(" \t\t\tregisterId: registerId.value\r\n");
      out.write(" \t\t};\r\n");
      out.write(" \t\tvar url = \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/opExpBalance/pricing.do\";\r\n");
      out.write(" \t\t$.post(url, data , function(r) {\r\n");
      out.write(" \t\t\tif(r == \"ok\") {\r\n");
      out.write(" \t\t\t\tmini.alert(\"划价保存成功\");\r\n");
      out.write(" \t\t\t\tshowItemList();// 加载收费项目\r\n");
      out.write(" \t\t\t\treturn;\r\n");
      out.write(" \t\t\t} else {\r\n");
      out.write(" \t\t\t\ttop.mini.error(r);\r\n");
      out.write(" \t\t\t}\r\n");
      out.write(" \t\t});\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 获取发票号码（不领用，不跳号） 测试代码！！！\r\n");
      out.write(" \tfunction getInvoiceNo() {\r\n");
      out.write("\t\t$.ajax({\r\n");
      out.write("\t\t\turl:\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/maintenance/invoice/getInvoiceNoNoUpdate.do\",\r\n");
      out.write("\t\t\ttype:\"post\",\r\n");
      out.write("\t\t\tdata:{invoiceType : \"O\"},\r\n");
      out.write("\t\t\tsuccess:function(r) {\r\n");
      out.write("\t\t\t\tif(r.state == \"ok\") {\r\n");
      out.write("\t \t\t\t\tmini.alert(r.invoiceNo);\r\n");
      out.write("\t \t\t\t} else {\r\n");
      out.write("\t \t\t\t\tmini.alert(r.msg);\r\n");
      out.write("\t \t\t\t}\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t});\r\n");
      out.write(" \t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 手工单项目下拉框渲染\r\n");
      out.write("\tfunction onshowpopup(e) {\r\n");
      out.write("\t\te.sender.on(\"drawcell\", function(r){\r\n");
      out.write("\t\t\tif(r.item.executeDeptId == \"-1\") {\r\n");
      out.write("\t\t\t\tr.cellStyle = \"color: #f00\";\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t});\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\tfunction show() {\r\n");
      out.write("\t\t$(\".hideBegin\").show();\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\tvar sexType = [{id:\"1\",text:\"男\"}, {id:\"2\",text:\"女\"}];\r\n");
      out.write("\t\r\n");
      out.write("</script>\r\n");
      out.write("</head>\r\n");
      out.write("<body>\r\n");
      out.write("\t<div class=\"mini-toolbar hideBegin\" style=\"display:none;\" borderStyle=\"border-top:0;border-right:1;border-left:1;border-bottom:1;\">\r\n");
      out.write("\t\t<span id=\"text01\" style=\"font-size:14px;color:#006aad;font-weight:bold;\">当日号</span>\r\n");
      out.write("\t\t<span>:</span>\r\n");
      out.write("\t\t<input id=\"key\" class=\"mini-textbox\" emptyText=\"按F2切换检索条件\" width=\"150\" onenter=\"queryOpExpRegister\"/>\r\n");
      out.write("\t\t<a class=\"mini-button\" onclick=\"registerView\"><span style=\"color:red\">挂号列表(F1)</span></a>\r\n");
      out.write("\t\t<a class=\"mini-button\" onclick=\"appendView\">加号</a>\r\n");
      out.write("\t\t<a class=\"mini-button\" onclick=\"updateInfoView\">修改信息</a>\r\n");
      out.write("\t\t<a class=\"mini-button\" onclick=\"calculatorView\">计算器</a>\r\n");
      out.write("\t\t<a class=\"mini-button\" onclick=\"refresh\">清空</a>\r\n");
      out.write("\t\t<a class=\"mini-button\" onclick=\"receiptView\">发票累计</a> \r\n");
      out.write("\t\t<!-- <a class=\"mini-button\" onclick=\"btnPrint_onclick()\">$打印发票测试$</a>  -->\r\n");
      out.write("\t\t<!-- <a class=\"mini-button\" iconCls=\"\" onclick=\"getInvoiceNo\">$取发票号测试$</a> -->\r\n");
      out.write("\t</div>\r\n");
      out.write("\t<div class=\"mini-toolbar hideBegin\" style=\"display:none;\" borderStyle=\"border-top:0px;border-left:1;border-right:1;border-bottom:solid 1px #c5c5c5;\" \r\n");
      out.write("\t\tstyle=\"font-size:10px; height:15px; line-height: 15px;\" >\r\n");
      out.write("\t\t挂号信息\t\r\n");
      out.write("\t</div>\r\n");
      out.write("\t<div id=\"form1\" class=\"mini-toolbar hideBegin\" style=\"display:none;\" borderStyle=\"border-top:0px;border-left:1;border-right:1;border-bottom:1\">\r\n");
      out.write("\t\t<input id=\"patientId\" name=\"patientId\" class=\"mini-hidden\"/>\r\n");
      out.write("\t\t<input id=\"registerId\" name=\"registerId\" class=\"mini-hidden\"/>\r\n");
      out.write("\t\t<input id=\"seeDoctId\" name=\"seeDoctId\" class=\"mini-hidden\"/>\r\n");
      out.write("\t\t<input id=\"seeDeptId\" name=\"seeDeptId\" class=\"mini-hidden\"/>\r\n");
      out.write("\t\t<input id=\"registerDoctId\" name=\"registerDoctId\" class=\"mini-hidden\"/>\r\n");
      out.write("\t\t<input id=\"registerDeptId\" name=\"registerDeptId\" class=\"mini-hidden\"/>\r\n");
      out.write("\t\t<input id=\"receiptNo\" name=\"receiptNo\" class=\"mini-hidden\" value=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${invoice.invoicePrefix}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${invoice.nextNumber}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("\"/>\r\n");
      out.write("\t\t<table style=\"font-size:14px;\">\r\n");
      out.write("\t\t\t<tr>\r\n");
      out.write("\t\t\t\t<td class=\"form-label required\" style=\"width:80px;\">姓名：</td>\r\n");
      out.write("\t\t\t\t<td><input id=\"patientName\" name=\"patientName\" class=\"mini-textbox\" allowInput=\"false\"/></td>\r\n");
      out.write("\t\t\t\t<td class=\"form-label required\" style=\"width:80px;\">出生日期：</td>\r\n");
      out.write("\t\t\t\t<td><input name=\"birthDate\" class=\"mini-datepicker\" enabled=\"false\"/></td>\r\n");
      out.write("\t\t\t\t<td class=\"form-label required\" style=\"width:50px;\">性别：</td>\r\n");
      out.write("\t\t\t\t<td>\r\n");
      out.write("\t\t\t\t\t<input name=\"sexCode\" class=\"mini-combobox\" style=\"width:40px;\" enabled=\"false\"\r\n");
      out.write("\t\t\t\t\t\tdata=\"[{id:'1',text:'男'}, {id:'2',text:'女'}]\"/>\r\n");
      out.write("\t\t\t\t</td>\r\n");
      out.write("\t\t\t\t<td class=\"form-label required\" style=\"width:50px;\">年龄：</td>\r\n");
      out.write("\t\t\t\t<td colspan=\"2\">\r\n");
      out.write("\t\t\t\t\t<input name=\"ageNum\" class=\"mini-textbox\" style=\"width:40px;\" allowInput=\"false\"/>\r\n");
      out.write("\t\t\t\t\t<input name=\"ageType\" class=\"mini-combobox\" style=\"width:50px;\" enabled=\"false\"\r\n");
      out.write("\t\t\t\t\t\tdata=\"[{id:'Y',text:'岁'},{id:'M',text:'月'},{id:'D',text:'天'},{id:'H',text:'小时'}]\"/>\r\n");
      out.write("\t\t\t\t</td>\r\n");
      out.write("\t\t\t\t<td class=\"form-label\" style=\"width:80px;\">诊断信息：</td>\r\n");
      out.write("\t\t\t\t<td class=\"blue-weight\">\r\n");
      out.write("\t\t\t\t\t<span id=\"diagText\">无</span>\r\n");
      out.write("\t\t\t\t</td>\r\n");
      out.write("\t\t\t</tr>\r\n");
      out.write("\t\t\t<tr>\r\n");
      out.write("\t\t\t\t<td class=\"form-label\">证件类型：</td>\r\n");
      out.write("\t\t\t\t<td>\r\n");
      out.write("\t\t\t\t\t<input name=\"idnetifierTypeId\" class=\"mini-combobox\" enabled=\"false\"\r\n");
      out.write("\t\t\t\t\t\turl=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/platform/system/sysDict/getKVs.do?dictType=BD_IDENTIFIER_TYPE\"/>\r\n");
      out.write("\t\t\t\t</td>\r\n");
      out.write("\t\t\t\t<td class=\"form-label\">证件号：</td>\r\n");
      out.write("\t\t\t\t<td colspan=\"2\"><input name=\"idnetifierNo\" class=\"mini-textbox\" style=\"width:180px;\" allowInput=\"false\"/></td>\r\n");
      out.write("\t\t\t\t<td class=\"form-label\" style=\"width:80px;\">电话：</td>\r\n");
      out.write("\t\t\t\t<td colspan=\"3\"><input name=\"phone\" class=\"mini-textbox\" style=\"width:150px;\" allowInput=\"false\"/></td>\r\n");
      out.write("\t\t\t\t<td class=\"form-label\">门慢信息：</td>\r\n");
      out.write("\t\t\t\t<td class=\"blue-weight\">\r\n");
      out.write("\t\t\t\t\t<a href=\"#\" onclick=\"openChronicInfo()\"><span id=\"chronicDiseaseText\">无</span></a>\r\n");
      out.write("\t\t\t\t\t<input id=\"chronicDiseaseId\" name=\"chronicDiseaseId\" class=\"mini-combobox\" visible=\"false\"\r\n");
      out.write("\t\t\t\t\t\t\turl=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/platform/system/sysDict/getKVs.do?dictType=BD_DRUGSILIMITMM\"/>\r\n");
      out.write("\t\t\t\t</td>\r\n");
      out.write("\t\t\t</tr>\r\n");
      out.write("\t\t\t<tr>\r\n");
      out.write("\t\t\t\t<td class=\"form-label required\">结算类别：</td>\r\n");
      out.write("\t\t\t\t<td>\r\n");
      out.write("\t\t\t\t\t<input id=\"patientMedicaltypeId\" name=\"patientMedicaltypeId\" class=\"mini-combobox\" enabled=\"false\"\r\n");
      out.write("\t\t\t\t\t\turl=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/common/medicalType/getChildKVs.do\"/>\r\n");
      out.write("\t\t\t\t</td>\r\n");
      out.write("\t\t\t\t<td class=\"form-label required\">结算种类：</td>\r\n");
      out.write("\t\t\t\t<td colspan=\"2\">\r\n");
      out.write("\t\t\t\t\t<input name=\"patientMedicaltypeKind\" class=\"mini-combobox\" style=\"width:180px;\" enabled=\"false\"\r\n");
      out.write("\t\t\t\t\t\turl=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/common/medicalTypeKind/getKVs.do\"/>\r\n");
      out.write("\t\t\t\t</td>\r\n");
      out.write("\t\t\t\t<td class=\"form-label\">医疗证号：</td>\r\n");
      out.write("\t\t\t\t<td colspan=\"3\"><input name=\"medicalCertificateNo\" class=\"mini-textbox\" style=\"width:150px;\" allowInput=\"false\"/></td>\r\n");
      out.write("\t\t\t\t<td class=\"form-label\">结算信息：</td>\r\n");
      out.write("\t\t\t\t<td class=\"blue-weight\">\r\n");
      out.write("\t\t\t\t\t<span id=\"payInfo\">无</span>\r\n");
      out.write("\t\t\t\t</td>\r\n");
      out.write("\t\t\t</tr>\r\n");
      out.write("\t\t</table>\r\n");
      out.write("\t</div>\t\r\n");
      out.write("\t<div class=\"mini-toolbar hideBegin\" style=\"display:none;\" borderStyle=\"border-top:0px;border-left:1;border-right:1;border-bottom:solid 1px #c5c5c5;\" \r\n");
      out.write("\t\tstyle=\"font-size:10px; height:15px; line-height: 15px;\" >\r\n");
      out.write("\t\t费用信息\t\r\n");
      out.write("\t</div>\r\n");
      out.write("\t<div class=\"mini-toolbar hideBegin\" style=\"display:none;\" borderStyle=\"border-top:0px;border-left:1;border-right:1;border-bottom:solid 0px\">\r\n");
      out.write("\t\t<a class=\"mini-button\" onclick=\"manual(0)\">新增手工单(F9)</a>\r\n");
      out.write("\t\t<a class=\"mini-button\" onclick=\"addItem\">新增(F10)</a>\r\n");
      out.write("\t\t<a class=\"mini-button\" onclick=\"removeItem\">删除</a>\r\n");
      out.write("\t\t<span class=\"separator\"></span>\r\n");
      out.write("\t\t<a class=\"mini-button\" onclick=\"save\">划价</a>\r\n");
      out.write("\t\t<a class=\"mini-button\" onclick=\"preCharge\">收费(F8)</a>\r\n");
      out.write("\t\t&emsp;&emsp;\r\n");
      out.write("\t\t<span style=\"font-size:14px;color:red;font-weight:bold;\">下一票号:</span>\r\n");
      out.write("\t\t<span id=\"invoiceNo\" style=\"font-size:14px;color:red;font-weight:bold;\">");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${invoice.invoiceNo}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("</span>\r\n");
      out.write("\t\t");
      out.write("\r\n");
      out.write("\t</div>\r\n");
      out.write("\t<div class=\"mini-fit\">\r\n");
      out.write("\t\t<div class=\"mini-splitter hideBegin\" style=\"display:none;width:100%;height:100%;\" allowResize=\"false\" handlerSize=\"6\"\r\n");
      out.write("\t\t\tborderStyle=\"border-top:0;border-left:0;border-right:0;border-bottom:0\">\r\n");
      out.write("\t\t\t<div size=\"80%\" showCollapseButton=\"false\">\r\n");
      out.write("\t\t        <div id=\"grid1\" class=\"mini-datagrid\" style=\"width:100%;height:100%;\" borderStyle=\"border-bottom:0\" allowCellSelect=\"true\"\r\n");
      out.write("\t\t        \t  contextMenu=\"#gridMenu\" allowCellEdit=\"true\" showModified=\"false\" editNextOnEnterKey=\"true\" skipReadOnlyCell=\"true\" \r\n");
      out.write("\t\t        \t showPager=\"false\" multiSelect=\"false\" allowUnselect=\"false\" idField=\"id\" allowResize=\"false\" oncellendedit=\"getCost\"\r\n");
      out.write("\t\t        \t ondrawgroup=\"onDrawGroup\" oncellbeginedit=\"oncellbeginedit\" onrowclick=\"showPackInfo\" oncelleditenter=\"celleditenter\">\r\n");
      out.write("\t\t        \t<div property=\"columns\">\r\n");
      out.write("\t\t        \t\t<div field=\"checkFlag\" type=\"checkboxcolumn\" trueValue=\"1\" falseValue=\"0\" width=\"40\">选择</div> \r\n");
      out.write("\t\t        \t\t<div type=\"indexcolumn\" headerAlign=\"center\" width=\"40\">序号</div>\r\n");
      out.write("\t\t        \t\t<div field=\"orderCombId\" visible=\"false\">组号</div>\r\n");
      out.write("\t\t        \t\t<div field=\"itemId\" name=\"itemId\" headerAlign=\"center\" align=\"center\" vtype=\"required\">编码\r\n");
      out.write("\t\t        \t\t\t<div property=\"editor\" class=\"mini-autocomplete\" popupWidth=\"1100\" popupHeight=\"500\" \r\n");
      out.write("\t\t\t\t\t \t\t\trequired=\"true\" allowInput=\"true\" valueField=\"itemId\" textField=\"itemId\" onshowpopup=\"onshowpopup\" \r\n");
      out.write("\t\t\t\t\t \t\t\t\turl=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/fee/outFeeCharge/getForManual.do\" onvaluechanged=\"onItemChanged\">\r\n");
      out.write("\t\t\t\t\t\t \t\t<div property=\"columns\" style=\"width:100%;\">\r\n");
      out.write("\t\t\t\t\t\t \t\t\t<div type=\"indexcolumn\"></div>\r\n");
      out.write("\t\t\t\t\t\t \t\t\t<div field=\"itemId\" headerAlign=\"center\" align=\"center\" width=\"60\">项目主键</div>\r\n");
      out.write("\t\t\t\t\t\t \t\t\t<div field=\"itemNo\" headerAlign=\"center\" align=\"center\" width=\"80\">编码</div>\r\n");
      out.write("\t\t\t\t\t\t \t\t\t<div field=\"itemName\" headerAlign=\"center\" align=\"center\" width=\"310\">名称</div>\r\n");
      out.write("\t\t\t\t\t\t \t\t\t<div field=\"nationCode\" headerAlign=\"center\" align=\"center\" width=\"80\">国标码</div>\r\n");
      out.write("\t\t\t\t\t\t \t\t\t<div field=\"specs\" headerAlign=\"center\" align=\"center\" width=\"110\">规格</div>\r\n");
      out.write("\t\t\t\t\t\t \t\t\t<div field=\"price\" headerAlign=\"center\" align=\"center\" width=\"60\">单价</div>\r\n");
      out.write("\t\t\t\t\t\t \t\t\t<div field=\"specialPrice\" headerAlign=\"center\" align=\"center\" width=\"60\">特诊价</div>\r\n");
      out.write("\t\t\t\t\t\t \t\t\t<div field=\"unit\" headerAlign=\"center\" align=\"center\" width=\"50\">单位</div>\r\n");
      out.write("\t\t\t\t\t\t \t\t\t<div field=\"sortNo\" headerAlign=\"center\" align=\"center\" width=\"50\">排序号</div>\r\n");
      out.write("\t\t\t\t\t\t \t\t\t<div field=\"orderFlag\" headerAlign=\"center\" align=\"center\" width=\"100\" type=\"comboboxcolumn\" readOnly=\"true\">是否开立不显示\r\n");
      out.write("\t\t\t\t\t\t \t\t\t\t<input property=\"editor\" class=\"mini-combobox\" style=\"width:100%;\" data=\"[{id:'0',text:'不显示'}, {id:'1',text:'显示'}]\"/>\r\n");
      out.write("\t\t\t\t\t\t \t\t\t</div>\r\n");
      out.write("\t\t\t\t\t\t \t\t\t<div field=\"itemFeeType\" width=\"0\">费用类别（隐藏）</div>\r\n");
      out.write("\t\t\t\t\t\t \t\t\t<div field=\"itemSourceType\" width=\"0\">项目来源类别（隐藏）</div>\r\n");
      out.write("\t\t\t\t\t\t \t\t\t<div field=\"itemSysType\" width=\"0\">系统类别(隐藏)</div>\r\n");
      out.write("\t\t\t\t\t\t \t\t\t<div field=\"packageFlag\" width=\"0\">复合项目标记(隐藏)</div>\r\n");
      out.write("\t\t\t\t\t\t \t\t\t<div field=\"itemSourceId\" width=\"0\">项目来源ID(隐藏)</div>\r\n");
      out.write("\t\t\t\t\t\t \t\t\t<div field=\"executeDeptId\" width=\"0\">执行科室(隐藏)</div>\r\n");
      out.write("\t\t\t\t\t\t \t\t\t<div field=\"identification\" width=\"0\">标识(隐藏)</div>\r\n");
      out.write("\t\t\t\t\t\t \t\t\t<div field=\"drugBulkUnit\" width=\"0\">散装单位(隐藏)</div>\r\n");
      out.write("\t\t\t\t\t\t \t\t\t<div field=\"drugPackageQty\" width=\"0\">包装数(隐藏)</div>\r\n");
      out.write("\t\t\t\t\t\t \t\t\t<div field=\"storageDeptName\" width=\"0\">库房名称(隐藏)</div>\r\n");
      out.write("\t\t\t\t\t\t \t\t\t<div field=\"storageQty\" width=\"0\">库存总数量(隐藏)</div>\r\n");
      out.write("\t\t\t\t\t\t \t\t</div>\r\n");
      out.write("\t\t\t\t\t\t \t</div>\r\n");
      out.write("\t\t\t\t\t\t</div>\r\n");
      out.write("\t\t        \t\t<div field=\"itemName\" headerAlign=\"center\" align=\"center\" width=\"300\" renderer=\"drugNameRenderer\">名称</div>\r\n");
      out.write("\t\t        \t\t<div field=\"specs\" visible=\"false\">规格(隐藏)</div>\r\n");
      out.write("\t\t        \t\t<div field=\"comb\" headerAlign=\"center\" align=\"center\" width=\"30\">.</div>\r\n");
      out.write("\t\t        \t\t<div field=\"orderOnceDosage\" headerAlign=\"center\" align=\"center\" width=\"60\">用量\r\n");
      out.write("\t\t        \t\t\t<input id=\"orderOnceDosage\" property=\"editor\" class=\"mini-textbox\" style=\"width:100%;\"/>\r\n");
      out.write("\t\t\t\t\t\t</div>\r\n");
      out.write("\t\t        \t\t<div field=\"price\" headerAlign=\"center\" align=\"center\" renderer=\"priceRenderer\" width=\"60\">单价</div>\r\n");
      out.write("\t\t        \t\t<div field=\"showQty\" headerAlign=\"center\" align=\"center\" width=\"60\">数量\r\n");
      out.write("\t\t\t\t\t\t\t<input id=\"showQty\" property=\"editor\" class=\"mini-textbox\" style=\"width:100%;\" onblur=\"\"/>\r\n");
      out.write("\t\t\t\t\t\t</div>\r\n");
      out.write("\t\t        \t\t<div field=\"showUnit\" type=\"comboboxcolumn\" headerAlign=\"center\" align=\"center\" width=\"60\" renderer=\"unitRenderer\" width=\"100\">单位\r\n");
      out.write("\t\t        \t\t\t<input property=\"editor\" class=\"mini-combobox\"/>\r\n");
      out.write("\t\t\t\t\t\t</div>\r\n");
      out.write("\t\t        \t\t<div field=\"executeDeptId\" type=\"comboboxcolumn\" headerAlign=\"center\" align=\"center\" readOnly=\"true\" width=\"140\">执行科室\r\n");
      out.write("\t\t\t\t\t\t\t<input property=\"editor\" class=\"mini-combobox\" url=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/platform/system/sysOrg/getKVs.do\" />\r\n");
      out.write("\t\t\t\t\t\t</div>\r\n");
      out.write("\t\t        \t\t<div field=\"identification\" headerAlign=\"center\" align=\"center\">标识</div>\r\n");
      out.write("\t\t        \t\t<div field=\"totCost\" headerAlign=\"center\" align=\"center\" width=\"60\">金额</div>\r\n");
      out.write("\t\t        \t\t<div field=\"itemFeeType\" type=\"comboboxcolumn\" headerAlign=\"center\" align=\"center\">类别\r\n");
      out.write("\t\t\t\t\t\t\t<input property=\"editor\" class=\"mini-combobox\" url=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/platform/system/sysDict/getKVs.do?dictType=BD_ITEMFEETYPE\" />\r\n");
      out.write("\t\t\t\t\t\t</div>\r\n");
      out.write("\t\t        \t\t<div field=\"billType\" visible=\"false\">处方类型(隐藏)</div>\r\n");
      out.write("\t\t        \t\t<div field=\"orderBillId\" visible=\"false\">电子单(隐藏)</div>\r\n");
      out.write("\t\t        \t\t<div field=\"recipeDoctId\" visible=\"false\">开方医生(隐藏)</div>\r\n");
      out.write("\t\t        \t\t<div field=\"recipeDeptId\" visible=\"false\">开方科室(隐藏)</div>\r\n");
      out.write("\t\t\t\t\t\t<div field=\"drugPackageUnit\" visible=\"false\">药品包装单位(隐藏)</div>\r\n");
      out.write("\t\t\t\t\t\t<div field=\"recipeDoctName\" visible=\"false\">开方医生名(隐藏)</div>\r\n");
      out.write("\t\t\t\t\t\t<div field=\"recipeDeptName\" visible=\"false\">开方诊室名(隐藏)</div>\r\n");
      out.write("\t\t\t\t\t\t<div field=\"packageFlag\" visible=\"false\">复合项目标记(隐藏)</div>\r\n");
      out.write("\t\t\t\t\t\t<div field=\"itemSourceType\" visible=\"false\">项目来源类别-0药品,1非药品(隐藏)</div>\r\n");
      out.write("\t\t\t\t\t\t<div field=\"itemSysType\" visible=\"false\">系统类别(隐藏)</div>\r\n");
      out.write("\t\t\t\t\t\t<div field=\"itemSourceId\" visible=\"false\">项目来源ID(隐藏)</div>\r\n");
      out.write("\t\t\t\t\t\t<div field=\"orderId\" visible=\"false\">医嘱项目流水号(隐藏)</div>\r\n");
      out.write("\t\t\t\t\t\t<div field=\"dataSourceWay\" visible=\"false\">数据来源方式(隐藏)</div>\r\n");
      out.write("\t\t\t\t\t\t<div field=\"dataSource\" visible=\"false\">数据来源(操作员，医嘱等。。)(隐藏)</div>\r\n");
      out.write("\t\t\t\t\t\t<div field=\"applyId\" visible=\"false\">收费ID(隐藏)</div>\r\n");
      out.write("\t\t\t\t\t\t<div field=\"drugPackageUnit\" visible=\"false\">包装单位(隐藏)</div>\r\n");
      out.write("\t\t\t\t\t\t<div field=\"drugBulkUnit\" visible=\"false\">散装单位(隐藏)</div>\r\n");
      out.write("\t\t\t\t\t\t<div field=\"drugPackageQty\" visible=\"false\">包装数(隐藏)</div>\r\n");
      out.write("\t\t\t\t\t\t<div field=\"applyNo\" visible=\"false\">收费序列(隐藏)</div>\r\n");
      out.write("\t\t\t\t\t\t<div field=\"storageDeptName\" visible=\"false\">库房名称(隐藏)</div>\r\n");
      out.write("\t\t\t\t\t\t<div field=\"storageQty\" visible=\"false\">库存总数量(隐藏)</div>\r\n");
      out.write("\t\t        \t</div>\r\n");
      out.write("\t\t        </div>\r\n");
      out.write("\t\t    </div>\r\n");
      out.write("\t\t    <div showCollapseButton=\"false\">\r\n");
      out.write("\t\t        <div id=\"grid2\" class=\"mini-datagrid\" style=\"width:100%;height:100%;\" borderStyle=\"border:0\"\r\n");
      out.write("\t\t        \t showPager=\"false\" >\r\n");
      out.write("\t\t        \t<div property=\"columns\">\r\n");
      out.write("\t\t       \t\t\t<div type=\"indexcolumn\" headerAlign=\"center\" align=\"center\" width=\"40\">序号\r\n");
      out.write("\t\t\t\t\t\t</div>\r\n");
      out.write("\t\t       \t\t\t<div field=\"tag.identification\" headerAlign=\"center\" align=\"center\" width=\"80\">标识\r\n");
      out.write("\t\t\t\t\t\t</div>\r\n");
      out.write("\t\t       \t\t\t<div field=\"name\" headerAlign=\"center\" align=\"center\" width=\"200\">项目名称\r\n");
      out.write("\t\t\t\t\t\t</div>\r\n");
      out.write("\t\t       \t\t\t<div field=\"price\" headerAlign=\"center\" align=\"center\" width=\"50\">价格\r\n");
      out.write("\t\t\t\t\t\t</div>\r\n");
      out.write("\t\t       \t\t\t<div field=\"qty\" headerAlign=\"center\" align=\"center\" width=\"50\">数量\r\n");
      out.write("\t\t\t\t\t\t</div>\r\n");
      out.write("\t\t       \t\t\t<div field=\"sourceItemId\" headerAlign=\"center\" align=\"center\" width=\"70\">项目编码\r\n");
      out.write("\t\t\t\t\t\t</div>\r\n");
      out.write("\t\t        \t</div>\r\n");
      out.write("\t\t        </div>\r\n");
      out.write("\t\t    </div>        \r\n");
      out.write("\t\t</div>\r\n");
      out.write("\t</div>\r\n");
      out.write("\t\r\n");
      out.write("\t<!-- 挂号记录 弹框 -->\r\n");
      out.write("\t<div id=\"win1\" title=\"选择患者信息 \" class=\"mini-window\" style=\"display:none;width:1000px;height:300px;\">\r\n");
      out.write("\t\t<div id=\"grid3\" class=\"mini-datagrid\" style=\"width:100%;height:100%;\" borderStyle=\"border:0\" allowCellEdit=\"false\" \r\n");
      out.write("\t\t\tonrowdblclick=\"queryData\" showPager=\"false\" multiSelect=\"false\" idField=\"id\" allowResize=\"false\">\r\n");
      out.write("        \t<div property=\"columns\">\r\n");
      out.write("        \t\t<div field=\"patientId\" headerAlign=\"center\" align=\"center\" width=\"70\">唯一号</div> \r\n");
      out.write("        \t\t<div field=\"patientName\" headerAlign=\"center\" align=\"center\" width=\"60\">患者姓名</div> \r\n");
      out.write("        \t\t<div field=\"sexCode\" headerAlign=\"center\" align=\"center\" width=\"30\" type=\"comboboxcolumn\">性别\r\n");
      out.write("        \t\t\t<input property=\"editor\" class=\"mini-combobox\" style=\"width:100%;\" data=\"sexType\"/>\r\n");
      out.write("        \t\t</div> \r\n");
      out.write("        \t\t<div field=\"age\" headerAlign=\"center\" align=\"center\" width=\"40\">年龄</div> \r\n");
      out.write("        \t\t<div field=\"idnetifierTypeId\" headerAlign=\"center\" align=\"center\" width=\"60\" type=\"comboboxcolumn\">号码类型\r\n");
      out.write("        \t\t\t<input property=\"editor\" class=\"mini-combobox\" style=\"width:100%;\" \r\n");
      out.write("\t\t\t \t\t\turl=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/platform/system/sysDict/getKVs.do?dictType=BD_IDENTIFIER_TYPE\"/>\r\n");
      out.write("        \t\t</div> \r\n");
      out.write("        \t\t<div field=\"idnetifierNo\" headerAlign=\"center\" align=\"center\">号码</div> \r\n");
      out.write("        \t\t<div field=\"phone\" headerAlign=\"center\" align=\"center\" width=\"70\">电话</div> \r\n");
      out.write("        \t\t<div field=\"registerDeptId\" headerAlign=\"center\" align=\"center\" type=\"comboboxcolumn\">科室\r\n");
      out.write("        \t\t\t<input property=\"editor\" class=\"mini-combobox\" style=\"width:100%;\" url=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/platform/system/sysOrg/getKVs.do\"/>\r\n");
      out.write("        \t\t</div> \r\n");
      out.write("        \t\t<div field=\"registerTime\" headerAlign=\"center\" align=\"center\">挂号日期</div> \r\n");
      out.write("        \t\t<div field=\"registerId\" visible=\"false\">registerId(隐藏)</div>\r\n");
      out.write("        \t</div>\r\n");
      out.write("        </div>\r\n");
      out.write("\t</div>\r\n");
      out.write("\t\r\n");
      out.write("\t<ul id=\"gridMenu\" class=\"mini-contextmenu\" style=\"display: none;\" onbeforeopen=\"onBeforeOpen\">\r\n");
      out.write("\t\t<li iconCls=\"fa fa-edit\" onclick=\"manual(1)\">修改手工单</li>\r\n");
      out.write("\t\t<li iconCls=\"fa fa-remove\" onclick=\"removeItem\">删除选中项</li>\r\n");
      out.write("\t\t<li iconCls=\"fa fa-remove\" onclick=\"removeApply\">删除手工单</li>\r\n");
      out.write("\t</ul>\r\n");
      out.write("\t\r\n");
      out.write("\t<div style=\"display:block;margin-top:-16\">\r\n");
      out.write("\t\t<script type=\"text/javascript\">\r\n");
      out.write("\t\t\tCreateReport(\"Report\");\r\n");
      out.write("\t\t</script>\r\n");
      out.write("\t</div>\r\n");
      out.write("\t\r\n");
      out.write("\t<script type=\"text/javascript\">\r\n");
      out.write("\t\tmini.parse();\r\n");
      out.write("\t\tvar form1 = new mini.Form(\"#form1\");\r\n");
      out.write("\t\tvar key = mini.get(\"key\");\r\n");
      out.write("\t\tkey.focus();\r\n");
      out.write("\t\tvar patientId = mini.get(\"patientId\");\r\n");
      out.write("\t\tvar registerId = mini.get(\"registerId\");\r\n");
      out.write("\t\tvar seeDoctId = mini.get(\"seeDoctId\");\r\n");
      out.write("\t\tvar seeDeptId = mini.get(\"seeDeptId\");\r\n");
      out.write("\t\tvar registerDoctId = mini.get(\"registerDoctId\");\r\n");
      out.write("\t\tvar registerDeptId = mini.get(\"registerDeptId\");\r\n");
      out.write("\t\tvar receiptNo = mini.get(\"receiptNo\");\r\n");
      out.write("\t\tvar chronicDiseaseId = mini.get(\"chronicDiseaseId\");\r\n");
      out.write("// \t\tvar invoiceId = mini.get(\"invoiceId\");\r\n");
      out.write("\t\tvar grid1 = mini.get(\"grid1\");\r\n");
      out.write("\t\tvar grid2 = mini.get(\"grid2\");\r\n");
      out.write("\t\tvar win1 = mini.get(\"win1\");\r\n");
      out.write("\t\tvar grid3 = mini.get(\"grid3\");\r\n");
      out.write("\t\t// 库存不足的药品项目背景色变绿\r\n");
      out.write("\t\tgrid1.on(\"drawcell\", function (e) {\r\n");
      out.write("\t\t\tvar record = e.record;\r\n");
      out.write("            //设置行样式\r\n");
      out.write("            if (!record.executeDeptId && (record.dataSourceWay != 0 || record.dataSource != 0)) {\r\n");
      out.write("                e.rowCls = \"myrow\";\r\n");
      out.write("            }\r\n");
      out.write("            if(e.field == \"identification\") {\r\n");
      out.write("            \te.cellStyle = \"font-weight:bold;\";\r\n");
      out.write("            }\r\n");
      out.write("\t\t});\r\n");
      out.write("\t\t\r\n");
      out.write("\t\t// 页面初始化时获取显示发票号时异常\r\n");
      out.write("\t\tvar state = \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${invoice.state}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("\";\r\n");
      out.write("\t\tif(state != \"ok\") {\r\n");
      out.write("\t\t\tmini.alert(\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${invoice.msg}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("\");\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\t\r\n");
      out.write("\t\tshow();\r\n");
      out.write("\t\t\r\n");
      out.write("\t</script>\r\n");
      out.write("</body>\r\n");
      out.write("</html>\r\n");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try {
            if (response.isCommitted()) {
              out.flush();
            } else {
              out.clearBuffer();
            }
          } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }

  private boolean _jspx_meth_c_005fset_005f0(javax.servlet.jsp.PageContext _jspx_page_context)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  c:set
    org.apache.taglibs.standard.tag.rt.core.SetTag _jspx_th_c_005fset_005f0 = (org.apache.taglibs.standard.tag.rt.core.SetTag) _005fjspx_005ftagPool_005fc_005fset_0026_005fvar_005fvalue_005fnobody.get(org.apache.taglibs.standard.tag.rt.core.SetTag.class);
    boolean _jspx_th_c_005fset_005f0_reused = false;
    try {
      _jspx_th_c_005fset_005f0.setPageContext(_jspx_page_context);
      _jspx_th_c_005fset_005f0.setParent(null);
      // /commons/include/get.jsp(5,0) name = var type = java.lang.String reqTime = false required = false fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
      _jspx_th_c_005fset_005f0.setVar("ctx");
      // /commons/include/get.jsp(5,0) name = value type = javax.el.ValueExpression reqTime = true required = false fragment = false deferredValue = true expectedTypeName = java.lang.Object deferredMethod = false methodSignature = null
      _jspx_th_c_005fset_005f0.setValue(new org.apache.jasper.el.JspValueExpression("/commons/include/get.jsp(5,0) '${pageContext.request.contextPath}'",_jsp_getExpressionFactory().createValueExpression(_jspx_page_context.getELContext(),"${pageContext.request.contextPath}",java.lang.Object.class)).getValue(_jspx_page_context.getELContext()));
      int _jspx_eval_c_005fset_005f0 = _jspx_th_c_005fset_005f0.doStartTag();
      if (_jspx_th_c_005fset_005f0.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
        return true;
      }
      _005fjspx_005ftagPool_005fc_005fset_0026_005fvar_005fvalue_005fnobody.reuse(_jspx_th_c_005fset_005f0);
      _jspx_th_c_005fset_005f0_reused = true;
    } finally {
      org.apache.jasper.runtime.JspRuntimeLibrary.releaseTag(_jspx_th_c_005fset_005f0, _jsp_getInstanceManager(), _jspx_th_c_005fset_005f0_reused);
    }
    return false;
  }

  private boolean _jspx_meth_c_005fset_005f1(javax.servlet.jsp.PageContext _jspx_page_context)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  c:set
    org.apache.taglibs.standard.tag.rt.core.SetTag _jspx_th_c_005fset_005f1 = (org.apache.taglibs.standard.tag.rt.core.SetTag) _005fjspx_005ftagPool_005fc_005fset_0026_005fvar_005fvalue_005fnobody.get(org.apache.taglibs.standard.tag.rt.core.SetTag.class);
    boolean _jspx_th_c_005fset_005f1_reused = false;
    try {
      _jspx_th_c_005fset_005f1.setPageContext(_jspx_page_context);
      _jspx_th_c_005fset_005f1.setParent(null);
      // /commons/include/get.jsp(6,0) name = var type = java.lang.String reqTime = false required = false fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
      _jspx_th_c_005fset_005f1.setVar("emr");
      // /commons/include/get.jsp(6,0) name = value type = javax.el.ValueExpression reqTime = true required = false fragment = false deferredValue = true expectedTypeName = java.lang.Object deferredMethod = false methodSignature = null
      _jspx_th_c_005fset_005f1.setValue(new org.apache.jasper.el.JspValueExpression("/commons/include/get.jsp(6,0) '${emrContextPath}'",_jsp_getExpressionFactory().createValueExpression(_jspx_page_context.getELContext(),"${emrContextPath}",java.lang.Object.class)).getValue(_jspx_page_context.getELContext()));
      int _jspx_eval_c_005fset_005f1 = _jspx_th_c_005fset_005f1.doStartTag();
      if (_jspx_th_c_005fset_005f1.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
        return true;
      }
      _005fjspx_005ftagPool_005fc_005fset_0026_005fvar_005fvalue_005fnobody.reuse(_jspx_th_c_005fset_005f1);
      _jspx_th_c_005fset_005f1_reused = true;
    } finally {
      org.apache.jasper.runtime.JspRuntimeLibrary.releaseTag(_jspx_th_c_005fset_005f1, _jsp_getInstanceManager(), _jspx_th_c_005fset_005f1_reused);
    }
    return false;
  }
}
