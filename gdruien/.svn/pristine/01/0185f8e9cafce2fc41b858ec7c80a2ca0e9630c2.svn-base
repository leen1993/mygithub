/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/9.0.2
 * Generated at: 2018-05-11 08:43:35 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.WEB_002dINF.view.expense.outpatient.fee;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import com.rekj.platform.model.system.SysResource;

public final class outFeeReceiptList_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent,
                 org.apache.jasper.runtime.JspSourceImports {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  static {
    _jspx_dependants = new java.util.HashMap<java.lang.String,java.lang.Long>(6);
    _jspx_dependants.put("jar:file:/E:/workspace.hisnew/hisbase/WebContent/WEB-INF/lib/jstl-1.2.jar!/META-INF/fn.tld", Long.valueOf(1153356282000L));
    _jspx_dependants.put("jar:file:/E:/workspace.hisnew/hisbase/WebContent/WEB-INF/lib/jstl-1.2.jar!/META-INF/c.tld", Long.valueOf(1153356282000L));
    _jspx_dependants.put("/WEB-INF/lib/jstl-1.2.jar", Long.valueOf(1525761782870L));
    _jspx_dependants.put("/commons/include/html_doctype.html", Long.valueOf(1525761798654L));
    _jspx_dependants.put("/commons/include/get.jsp", Long.valueOf(1525827802831L));
    _jspx_dependants.put("jar:file:/E:/workspace.hisnew/hisbase/WebContent/WEB-INF/lib/jstl-1.2.jar!/META-INF/fmt.tld", Long.valueOf(1153356282000L));
  }

  private static final java.util.Set<java.lang.String> _jspx_imports_packages;

  private static final java.util.Set<java.lang.String> _jspx_imports_classes;

  static {
    _jspx_imports_packages = new java.util.HashSet<>();
    _jspx_imports_packages.add("javax.servlet");
    _jspx_imports_packages.add("javax.servlet.http");
    _jspx_imports_packages.add("javax.servlet.jsp");
    _jspx_imports_classes = new java.util.HashSet<>();
    _jspx_imports_classes.add("com.rekj.platform.model.system.SysResource");
  }

  private org.apache.jasper.runtime.TagHandlerPool _005fjspx_005ftagPool_005fc_005fset_0026_005fvar_005fvalue_005fnobody;

  private volatile javax.el.ExpressionFactory _el_expressionfactory;
  private volatile org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public java.util.Set<java.lang.String> getPackageImports() {
    return _jspx_imports_packages;
  }

  public java.util.Set<java.lang.String> getClassImports() {
    return _jspx_imports_classes;
  }

  public javax.el.ExpressionFactory _jsp_getExpressionFactory() {
    if (_el_expressionfactory == null) {
      synchronized (this) {
        if (_el_expressionfactory == null) {
          _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
        }
      }
    }
    return _el_expressionfactory;
  }

  public org.apache.tomcat.InstanceManager _jsp_getInstanceManager() {
    if (_jsp_instancemanager == null) {
      synchronized (this) {
        if (_jsp_instancemanager == null) {
          _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
        }
      }
    }
    return _jsp_instancemanager;
  }

  public void _jspInit() {
    _005fjspx_005ftagPool_005fc_005fset_0026_005fvar_005fvalue_005fnobody = org.apache.jasper.runtime.TagHandlerPool.getTagHandlerPool(getServletConfig());
  }

  public void _jspDestroy() {
    _005fjspx_005ftagPool_005fc_005fset_0026_005fvar_005fvalue_005fnobody.release();
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
      throws java.io.IOException, javax.servlet.ServletException {

    final java.lang.String _jspx_method = request.getMethod();
    if (!"GET".equals(_jspx_method) && !"POST".equals(_jspx_method) && !"HEAD".equals(_jspx_method) && !javax.servlet.DispatcherType.ERROR.equals(request.getDispatcherType())) {
      response.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, "JSPs only permit GET POST or HEAD");
      return;
    }

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write('\r');
      out.write('\n');
      out.write("<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">");
      out.write("\r\n");
      out.write("\r\n");
      out.write("<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n");
      out.write("<head>\r\n");
      out.write("<title>（门诊）发票清单</title>\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      if (_jspx_meth_c_005fset_005f0(_jspx_page_context))
        return;
      out.write('\r');
      out.write('\n');
      if (_jspx_meth_c_005fset_005f1(_jspx_page_context))
        return;
      out.write("\r\n");
      out.write("<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\r\n");
      out.write("<meta http-equiv=\"X-UA-Compatible\" content=\"IE=EmulateIE8\" />\r\n");
      out.write("\r\n");
      out.write("<script src=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/scripts/boot.js\" type=\"text/javascript\"></script>\r\n");
      out.write("<script type=\"text/javascript\" src=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/commons/dynamic.jsp\"></script>\r\n");
      out.write("\r\n");
      out.write("<script type=\"text/javascript\" src=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/scripts/core.js\"></script>\r\n");
      out.write("<script type=\"text/javascript\" src=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/scripts/plugins/template/jquery.tmpl.min.js\"></script>\r\n");
      out.write("\r\n");
      out.write("<link href=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/styles/default/css/web.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("<script src=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/scripts/plugins/report/CreateControl.js\" type=\"text/javascript\"></script>\r\n");
      out.write("\r\n");
      out.write("<style type=\"text/css\">\r\n");
      out.write("\t.required {\r\n");
      out.write("\t\tcolor:#006aad;\r\n");
      out.write("\t}\r\n");
      out.write("\t.form-label {\r\n");
      out.write("\t\twidth:60px;\r\n");
      out.write("\t}\r\n");
      out.write("\t.blue-weight {\r\n");
      out.write("\t\tfont-size:8px;\r\n");
      out.write("\t\tcolor:#006aad;\r\n");
      out.write("\t\tfont-weight:bold;\r\n");
      out.write("\t}\r\n");
      out.write("</style>\r\n");
      out.write("<script type=\"text/javascript\">\r\n");
      out.write(" \t\r\n");
      out.write("\t//直接打印发票不经过预览\r\n");
      out.write("\tfunction btnPrint_onclick(r) {\r\n");
      out.write("// \t\tvar report = document.getElementById(\"Report\");\r\n");
      out.write("// \t\treport.LoadFromURL(\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/report/template/opExpReceiptPreview.grf?t=\"+new Date().getTime());\r\n");
      out.write("\t\t\r\n");
      out.write("\t\treport.ParameterByName(\"registerDeptName\").AsString = r.registerDeptName;\r\n");
      out.write("\t\treport.ParameterByName(\"invoiceNo\").AsString = r.invoiceNo;\r\n");
      out.write("\t\treport.ParameterByName(\"patientName\").AsString = r.patientName;\r\n");
      out.write("\t\treport.ParameterByName(\"receiptTime\").AsString = r.receiptTime;\r\n");
      out.write("\t\tif(r.drugWindow) {\r\n");
      out.write("\t\t\treport.ParameterByName(\"drugWindow\").AsString = r.drugWindow;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\treport.ParameterByName(\"ownCost\").AsString = r.ownCost;\r\n");
      out.write("\t\treport.ParameterByName(\"receiptOperId\").AsString = r.receiptOperId;\r\n");
      out.write("\t\t\r\n");
      out.write("\t\treport.ParameterByName(\"fee1\").AsString = r.receiptListList[0].itemStattypeName + \"  \" + r.receiptListList[0].ownCost;\r\n");
      out.write("\t\tif(r.receiptListList[1]) {\r\n");
      out.write("\t\t\treport.ParameterByName(\"fee2\").AsString = r.receiptListList[1].itemStattypeName + \"  \" + r.receiptListList[1].ownCost;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tif(r.receiptListList[2]) {\r\n");
      out.write("\t\t\treport.ParameterByName(\"fee3\").AsString = r.receiptListList[2].itemStattypeName + \"  \" + r.receiptListList[2].ownCost;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tif(r.receiptListList[3]) {\r\n");
      out.write("\t\t\treport.ParameterByName(\"fee4\").AsString = r.receiptListList[3].itemStattypeName + \"  \" + r.receiptListList[3].ownCost;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tif(r.receiptListList[4]) {\r\n");
      out.write("\t\t\treport.ParameterByName(\"fee5\").AsString = r.receiptListList[4].itemStattypeName + \"  \" + r.receiptListList[4].ownCost;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tif(r.receiptListList[5]) {\r\n");
      out.write("\t\t\treport.ParameterByName(\"fee6\").AsString = r.receiptListList[5].itemStattypeName + \"  \" + r.receiptListList[5].ownCost;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\t\r\n");
      out.write("\t\treport.Printer.PrinterName = \"Adobe PDF\";\r\n");
      out.write("\t\t\r\n");
      out.write("\t\t/* report.PrintPreview(true);// 打印预览\r\n");
      out.write("\t\treport.Print(false);// false为直接打印 */\r\n");
      out.write("\t}\r\n");
      out.write(" \t\r\n");
      out.write("\t// 患者结算信息 字符串\r\n");
      out.write("\tvar costBref;\r\n");
      out.write(" \t\r\n");
      out.write("\t// F2切换标记\r\n");
      out.write("\tvar num = 2;\r\n");
      out.write("\t\r\n");
      out.write("\t// 按F2切换检索条件\r\n");
      out.write("\tdocument.onkeydown=function(){\r\n");
      out.write("\t\t if(event.keyCode==113) {\r\n");
      out.write("\t\t\t switch(num)\r\n");
      out.write("\t\t\t\t{\r\n");
      out.write("\t\t\t\tcase 1:\r\n");
      out.write("\t\t\t\t\tdocument.getElementById('text01').innerText = '当日号';\r\n");
      out.write("\t\t\t\t\tnum = 2 ;\r\n");
      out.write("\t\t\t\t\tbreak;\r\n");
      out.write("\t\t\t\tcase 2:\r\n");
      out.write("\t\t\t\t\tdocument.getElementById('text01').innerText = '唯一号';\r\n");
      out.write("\t\t\t\t\tnum = 3 ;\r\n");
      out.write("\t\t\t\t\tbreak;\r\n");
      out.write("\t\t\t\tcase 3:\r\n");
      out.write("\t\t\t\t\tdocument.getElementById('text01').innerText = '姓　名';\r\n");
      out.write("\t\t\t\t\tnum = 1 ;\r\n");
      out.write("\t\t\t\t\tbreak;\r\n");
      out.write("\t\t\t\t}\r\n");
      out.write("\t\t }\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 按条件查询挂号信息\r\n");
      out.write("\tfunction queryOpExpRegister(e) {\r\n");
      out.write("\t\tclear();// 清空页面\r\n");
      out.write("\t\tvar key = mini.get(\"key\").getValue();\r\n");
      out.write("\t\tif(!key){\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tswitch(num)\r\n");
      out.write("\t\t{\r\n");
      out.write("\t\tcase 1:\r\n");
      out.write("\t\t\tgetByName(key);\r\n");
      out.write("\t\t\tbreak;\r\n");
      out.write("\t\tcase 2:\r\n");
      out.write("\t\t\tgetBySerialId(key);\r\n");
      out.write("\t\t\tbreak;\r\n");
      out.write("\t\tcase 3:\r\n");
      out.write("\t\t\tgetByPatientId(key);\r\n");
      out.write("\t\t\tbreak;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 根据当日号获取病人基本信息，看诊以及处方信息\r\n");
      out.write("\tfunction getBySerialId(e) {\r\n");
      out.write("\t\tif(e == null) {\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tvar url = \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/fee/outFeeCancel/getBySerialId.do\";\r\n");
      out.write("\t\tvar data = {dailySerialId : e, dayNum : 180} ;\r\n");
      out.write("\t\t$.post(url, data , function(r) {\r\n");
      out.write("\t\t\tshowData(r);\r\n");
      out.write("\t\t});\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 根据唯一号获取病人基本信息，看诊以及处方信息\r\n");
      out.write("\tfunction getByPatientId(e) {\r\n");
      out.write("\t\tif(e == null) {\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tvar url = \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/fee/outFeeCancel/getByPatientId.do\";\r\n");
      out.write("\t\tvar data = {patientId : e, dayNum : 180} ;\r\n");
      out.write("\t\t$.post(url, data , function(r) {\r\n");
      out.write("\t\t\tshowData(r);\r\n");
      out.write("\t\t});\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 根据姓名获取病人基本信息，看诊以及处方信息\r\n");
      out.write("\tfunction getByName(e) {\r\n");
      out.write("\t\tvar url = \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/fee/outFeeCancel/getByName.do\";\r\n");
      out.write("\t\tvar data = {patientName : e, dayNum : 180} ;\r\n");
      out.write("\t\t$.post(url, data , function(r) {\r\n");
      out.write("\t\t\tshowData(r);\r\n");
      out.write("\t\t});\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 根据门诊流水号获取病人基本信息，看诊以及处方信息\r\n");
      out.write("\tfunction getByRegId(e) {\r\n");
      out.write("\t\tvar url = \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/fee/outFeeCancel/getByRegId.do\";\r\n");
      out.write("\t\tvar data = e;\r\n");
      out.write("\t\t$.post(url, data , function(r) {\r\n");
      out.write("\t\t\tshowData(r);\r\n");
      out.write("\t\t});\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 根据系列号（收据ID）检索信息\r\n");
      out.write("\tfunction getByReceiptId() {\r\n");
      out.write("\t\tvar id = receiptId.getValue();\r\n");
      out.write("\t\tif(!id) {\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t} else {\r\n");
      out.write("\t\t\tvar url = \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/fee/outFeeCancel/getByReceiptId.do\";\r\n");
      out.write("\t\t\tvar data = {receiptId : id, dayNum : 180};\r\n");
      out.write("\t\t\t$.post(url, data , function(r) {\r\n");
      out.write("\t\t\t\tshowData(r);\r\n");
      out.write("\t\t\t});\r\n");
      out.write("\t\t}\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 根据发票号检索信息\r\n");
      out.write("\tfunction getByReceiptNo() {\r\n");
      out.write("\t\tvar no = receiptNo.getValue();\r\n");
      out.write("\t\tif(!no) {\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t} else {\r\n");
      out.write("\t\t\tvar url = \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/fee/outFeeCancel/getByReceiptNo.do\";\r\n");
      out.write("\t\t\tvar data = {receiptNo : no};\r\n");
      out.write("\t\t\t$.post(url, data , function(r) {\r\n");
      out.write("\t\t\t\tshowData(r);\r\n");
      out.write("\t\t\t});\r\n");
      out.write("\t\t}\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 将检索到的数据填充至页面\r\n");
      out.write("\tfunction showData(r) {\r\n");
      out.write("\t\tif(r.state == \"noReceipt\") {\r\n");
      out.write("\t\t\tmini.alert(\"最近180天没有找到有效的发票\");\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tif(r.state == \"noPatient\") {\r\n");
      out.write("\t\t\tmini.alert(\"没有找到患者信息\");\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tif(r.state == \"showRegList\") {// 弹出该患者的多条挂号记录供选择\r\n");
      out.write("\t\t\tgrid2.setData(r.data);\r\n");
      out.write("\t\t\twin1.show();\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tif(r.state == \"showReceiptList\") {// 显示多条结算记录弹框\r\n");
      out.write("\t\t\tgrid3.setData(r.data);\r\n");
      out.write("\t\t\twin2.show();\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tif(r.state == \"showPatientList\") {// 显示同名患者弹框\r\n");
      out.write("\t\t\tgrid2.setData(r.data);\r\n");
      out.write("\t\t\twin1.show();\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tif(r.state == \"showData\") {// 只有一条结算记录\r\n");
      out.write("\t\t\t// 加载项目信息\r\n");
      out.write("\t\t\tvar data = {\r\n");
      out.write("\t\t\t\t\tregisterId : r.registerId ,\r\n");
      out.write("\t\t\t\t\tbalanceId : r.balanceId ,\r\n");
      out.write("\t\t\t\t\ttransFlag : \"1\" ,\r\n");
      out.write("\t\t\t\t\tbalanceFlag : \"1\"\r\n");
      out.write("\t\t\t\t};\r\n");
      out.write("\t\t\tgrid1.load(data);\r\n");
      out.write("\t\t\treceiptId.setValue(r.receiptId);\r\n");
      out.write("\t\t\tinvoiceNo.setValue(r.invoiceNo);\r\n");
      out.write("\t\t\treceiptTime.setValue(r.receiptTime);\r\n");
      out.write("\t\t\t\r\n");
      out.write("\t\t\t// 回填患者信息\r\n");
      out.write("\t\t\tvar data2 = {\r\n");
      out.write("\t\t\t\tregisterId : r.registerId ,\r\n");
      out.write("\t\t\t\tbalanceId : r.balanceId ,\r\n");
      out.write("\t\t\t\tdayNum : 180\r\n");
      out.write("\t\t\t};\r\n");
      out.write("\t\t\tgetByRegisterId(data2);\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t} \r\n");
      out.write("\t\r\n");
      out.write("\t// 双击 挂号记录/重复姓名 弹框条目\r\n");
      out.write("\tfunction queryData(e) {\r\n");
      out.write("\t\twin1.hide();// 隐藏弹框\r\n");
      out.write("\t\tvar registerId = e.row.registerId;\r\n");
      out.write("\t\tvar patientId = e.row.patientId;\r\n");
      out.write("\t\tif(!registerId) {// 姓名搜索弹窗(同名患者列表)，根据唯一号查找\r\n");
      out.write("\t\t\tgetByPatientId(patientId);\r\n");
      out.write("\t\t} else {// 唯一号搜索弹窗(挂号记录列表)，根据流水号查找\r\n");
      out.write("\t\t\tvar data = {registerId : registerId} ;\r\n");
      out.write("\t\t\tgetByRegId(data);\r\n");
      out.write("\t\t}\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 双击结算信息弹窗(选择发票弹框)条目\r\n");
      out.write("\tfunction getByReceipt(e) {\r\n");
      out.write("\t\twin2.hide();\r\n");
      out.write("\t\t// 加载项目信息\r\n");
      out.write("\t\tvar data = {\r\n");
      out.write("\t\t\t\tregisterId : e.row.registerId ,\r\n");
      out.write("\t\t\t\tbalanceId : e.row.balanceId ,\r\n");
      out.write("\t\t\t\ttransFlag : \"1\" ,\r\n");
      out.write("\t\t\t\tbalanceFlag : \"1\"\r\n");
      out.write("\t\t\t};\r\n");
      out.write("\t\tgrid1.load(data);\r\n");
      out.write("\t\treceiptId.setValue(e.row.receiptId);\r\n");
      out.write("\t\tinvoiceNo.setValue(e.row.invoiceNo);\r\n");
      out.write("\t\treceiptTime.setValue(e.row.receiptTime);\r\n");
      out.write("\t\t\r\n");
      out.write("\t\t// 回填患者信息\r\n");
      out.write("\t\tvar data2 = {\r\n");
      out.write("\t\t\t\tregisterId : e.row.registerId ,\r\n");
      out.write("\t\t\t\tbalanceId : e.row.balanceId ,\r\n");
      out.write("\t\t\t\tdayNum : 180\r\n");
      out.write("\t\t\t};\r\n");
      out.write("\t\tgetByRegisterId(data2);\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 根据门诊流水号查询患者基本信息，门诊诊断信息\r\n");
      out.write("\tfunction getByRegisterId(e) {\r\n");
      out.write("\t\tvar url = \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/fee/outFeeCancel/getByRegisterId.do\";\r\n");
      out.write("\t\t$.post(url, e , function(r) {\r\n");
      out.write("\t\t\tform1.setData(r);\r\n");
      out.write("\t\t\t\r\n");
      out.write("\t\t\tdocument.getElementById(\"diagName\").innerHTML = r.tag.diagName;\r\n");
      out.write("\t\t\tif(chronicDiseaseId.text == \"\" || chronicDiseaseId.text == null) {\r\n");
      out.write("\t\t\t\tdocument.getElementById(\"chronicDiseaseText\").innerHTML = \"无\";\r\n");
      out.write("\t\t\t} else {\r\n");
      out.write("\t\t\t\tdocument.getElementById(\"chronicDiseaseText\").innerHTML = chronicDiseaseId.text;\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t\tvar outJZDNums = \"\";// 限记账单张数\r\n");
      out.write("\t\t\tif(\"P\" == r.patientPaytypeId) {\r\n");
      out.write("\t\t\t\toutJZDNums = \"　限记账单张数：\" + r.tag.outJZDNums;\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t\tif(!(r.tag.outpayRate) || r.tag.outpayRate == null || r.tag.outpayRate == \"\") {\r\n");
      out.write("\t\t\t\tdocument.getElementById(\"outpayRate\").innerHTML = \"自付比例：0.0%\" + outJZDNums;\r\n");
      out.write("\t\t\t} else {\r\n");
      out.write("\t\t\t\tdocument.getElementById(\"outpayRate\").innerHTML = \"自付比例：\" + ((r.tag.outpayRate) * 100) + \".0%\" + outJZDNums;\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t\t\r\n");
      out.write("\t\t\tcostBref = r.patientName + \"　发票号：\" + r.tag.receiptNo + \"　\" + medicaltype.text + \"　结算日期：\" + r.tag.balanceTime + \r\n");
      out.write("\t\t\t\t\"　总金额：\" + r.tag.totCost + \"　个人自付：\" + r.tag.ownpayCost + \"　记账：\" + r.tag.pubCost;\r\n");
      out.write("\t\t\tdocument.getElementById(\"textBref\").innerHTML = costBref;\r\n");
      out.write("\t\t});\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 打开门慢信息(页面)\r\n");
      out.write(" \tfunction openChronicInfo () {\r\n");
      out.write(" \t\tif (!registerId.value) {\r\n");
      out.write(" \t\t\treturn;\r\n");
      out.write(" \t\t}\r\n");
      out.write(" \t\tmini.open({\r\n");
      out.write("            url: \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/fee/outFeeCharge/chronicInfo.do?registerId=\" + registerId.value,\r\n");
      out.write("            title: \"请选择门慢信息\", \r\n");
      out.write("            width: 520, \r\n");
      out.write("            height: 400,\r\n");
      out.write("            ondestroy: function (r) {\r\n");
      out.write("            \tshowInfo(r);\r\n");
      out.write("        \t} \r\n");
      out.write("        }); \r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 回填获取的信息到主页面\r\n");
      out.write(" \tfunction showInfo (r) {\r\n");
      out.write(" \t\tif (r.type == \"yes\") {\r\n");
      out.write("    \t\tvar data = mini.decode(r);\r\n");
      out.write("    \t\tform1.setData(data); \r\n");
      out.write("    \t\tif (!r.chronicDiseaseId || r.chronicDiseaseId.isEmpty()) {\r\n");
      out.write("    \t\t\tdocument.getElementById(\"chronicDiseaseText\").innerHTML = \"无\";\r\n");
      out.write("    \t\t}else {\r\n");
      out.write("    \t\t\tdocument.getElementById(\"chronicDiseaseText\").innerHTML = chronicDiseaseId.text;\r\n");
      out.write("    \t\t}\r\n");
      out.write("    \t}\r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 分组渲染\r\n");
      out.write("\tfunction group () {\r\n");
      out.write("\t\tgrid1.on(\"drawcell\", function (e) {\r\n");
      out.write("\t\t\tvar record = e.record,\r\n");
      out.write("\t        column = e.column,\r\n");
      out.write("\t        field = e.field,\r\n");
      out.write("\t        value = e.value;\r\n");
      out.write("\t\t\tif (grid1.totalCount == 0) {\r\n");
      out.write("\t\t\t\treturn;\r\n");
      out.write("\t\t\t}else if (grid1.totalCount == 1) {\r\n");
      out.write("\t\t\t\trecord.comb = '';\r\n");
      out.write("\t\t\t}else if (grid1.getRow(e.rowIndex).orderGroupNo == null) {\r\n");
      out.write("\t\t\t\trecord.comb = '';\r\n");
      out.write("\t\t\t}else if (e.rowIndex == 0 && grid1.getRow(0).orderGroupNo == grid1.getRow(1).orderGroupNo) {\r\n");
      out.write("\t\t\t\trecord.comb = '┓';\r\n");
      out.write("\t\t\t}else if (e.rowIndex > 0 && e.rowIndex < grid1.totalCount-1 && \r\n");
      out.write("\t\t\t\t\tgrid1.getRow(e.rowIndex).orderGroupNo != grid1.getRow(e.rowIndex-1).orderGroupNo\r\n");
      out.write("\t\t\t\t\t&& grid1.getRow(e.rowIndex).orderGroupNo == grid1.getRow(e.rowIndex+1).orderGroupNo) {\r\n");
      out.write("\t\t\t\trecord.comb = '┓';\r\n");
      out.write("\t\t\t}else if (e.rowIndex > 0 && e.rowIndex < grid1.totalCount-1 && \r\n");
      out.write("\t\t\t\t\tgrid1.getRow(e.rowIndex).orderGroupNo == grid1.getRow(e.rowIndex-1).orderGroupNo\r\n");
      out.write("\t\t\t\t\t&& grid1.getRow(e.rowIndex).orderGroupNo == grid1.getRow(e.rowIndex+1).orderGroupNo) {\r\n");
      out.write("\t\t\t\trecord.comb = '|';\r\n");
      out.write("\t\t\t}else if (e.rowIndex > 0 && e.rowIndex < grid1.totalCount-1 &&\r\n");
      out.write("\t\t\t\t\tgrid1.getRow(e.rowIndex).orderGroupNo == grid1.getRow(e.rowIndex-1).orderGroupNo\r\n");
      out.write("\t\t\t\t\t&& grid1.getRow(e.rowIndex).orderGroupNo != grid1.getRow(e.rowIndex+1).orderGroupNo) {\r\n");
      out.write("\t\t\t\trecord.comb = '┛';\r\n");
      out.write("\t\t\t}else if (e.rowIndex == grid1.totalCount-1 && \r\n");
      out.write("\t\t\t\t\tgrid1.getRow(e.rowIndex).orderGroupNo == grid1.getRow(e.rowIndex-1).orderGroupNo) {\r\n");
      out.write("\t\t\t\trecord.comb = '┛';\r\n");
      out.write("\t\t\t}else {\r\n");
      out.write("\t\t\t\trecord.comb = '';\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t});\r\n");
      out.write("\t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 生成处方号表头\r\n");
      out.write("\tfunction onDrawGroup(e) {        \r\n");
      out.write("\t\te.cellHtml = \"处方号：\" + e.value;\r\n");
      out.write("    }\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 处方项目加载成功时\r\n");
      out.write(" \tfunction onLoad(e) {\r\n");
      out.write("        grid1.groupBy(\"orderBillId\", \"asc\");\r\n");
      out.write("\t\tgroup();\r\n");
      out.write(" \t\tdocument.getElementById(\"divBref\").style.display=\"\";\r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 清空页面\r\n");
      out.write(" \tfunction clear() {\r\n");
      out.write("//  \tform0.clear();\r\n");
      out.write(" \t\tform1.clear();\r\n");
      out.write(" \t\tgrid1.clearRows();\r\n");
      out.write(" \t\tgrid2.clearRows();\r\n");
      out.write(" \t\tdocument.getElementById(\"diagName\").innerHTML = \"无\";\r\n");
      out.write("\t\tdocument.getElementById(\"chronicDiseaseText\").innerHTML = \"无\";\r\n");
      out.write("\t\tdocument.getElementById(\"outpayRate\").innerHTML = \"无\";\r\n");
      out.write("\t\tdocument.getElementById(\"divBref\").style.display=\"none\";\r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 发票预览\r\n");
      out.write(" \tfunction previewInvoice() {\r\n");
      out.write(" \t\tif(!receiptId.value) {\r\n");
      out.write(" \t\t\treturn;\r\n");
      out.write(" \t\t}\r\n");
      out.write(" \t\t\r\n");
      out.write(" \t\tvar url = \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/opExpReceipt/opReceiptPrint.do\";\r\n");
      out.write("\t\tvar data = {\r\n");
      out.write("\t\t\tregisterId : registerId.value,\r\n");
      out.write("\t\t\treceiptId : receiptId.value\r\n");
      out.write("\t\t};\r\n");
      out.write("\t\t$.post(url, data , function(r) {\r\n");
      out.write("\t\t\treport.LoadFromURL(\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/report/template/opExpReceiptPreview.grf?t=\"+new Date().getTime());\r\n");
      out.write("\t\t\tbtnPrint_onclick(r);\r\n");
      out.write("\t\t\treport.PrintPreview(true);// 打印预览\r\n");
      out.write("\t\t});\r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 发票补打\r\n");
      out.write(" \tfunction printReceipt() {\r\n");
      out.write(" \t\tif(!receiptId.value) {\r\n");
      out.write(" \t\t\treturn;\r\n");
      out.write(" \t\t}\r\n");
      out.write(" \t\tmini.confirm(\"确定要补打发票吗？补打发票不会走号，请留意...\",\r\n");
      out.write(" \t\t\t\t\"提示\",\r\n");
      out.write(" \t\t\t\tfunction(action) {\r\n");
      out.write("\t\t \t\t\tif (action == \"ok\") {\r\n");
      out.write("\t\t \t\t\t\tdoPrintReceipt();\r\n");
      out.write("\t\t\t\t\t} else {\r\n");
      out.write("\t\t\t\t\t\treturn;\r\n");
      out.write("\t\t\t\t\t}\r\n");
      out.write(" \t\t\t\t}\r\n");
      out.write(" \t\t);\r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 执行发票补打\r\n");
      out.write(" \tfunction doPrintReceipt() {\r\n");
      out.write(" \t\tvar url = \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/opExpReceipt/opReceiptPrint.do\";\r\n");
      out.write("\t\tvar data = {\r\n");
      out.write("\t\t\tregisterId : registerId.value,\r\n");
      out.write("\t\t\treceiptId : receiptId.value\r\n");
      out.write("\t\t};\r\n");
      out.write("\t\t$.post(url, data , function(r) {\r\n");
      out.write("\t\t\treport.LoadFromURL(\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/report/template/opExpReceipt.grf?t=\"+new Date().getTime());\r\n");
      out.write("\t\t\tbtnPrint_onclick(r);\r\n");
      out.write("\t\t\treport.Print(false);\r\n");
      out.write("\t\t});\r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write(" \t// 发票重打\r\n");
      out.write(" \tfunction reprintReceipt() {\r\n");
      out.write(" \t\tif(!receiptId.value) {\r\n");
      out.write(" \t\t\treturn;\r\n");
      out.write(" \t\t}\r\n");
      out.write(" \t\tmini.confirm(\r\n");
      out.write(" \t\t\t\t\"确定重打患者【\" + patientName.value + \"】的发票【 \" + invoiceNo.value + \"】？\" + \"<br/>\" +\r\n");
      out.write(" \t\t\t\t\"请注意：重打时，发票号会跳号！！！！！！！！！！！！！！！！\",\r\n");
      out.write(" \t\t\t\t\"提示\",\r\n");
      out.write(" \t\t\t\tfunction(action) {\r\n");
      out.write("\t\t \t\t\tif (action == \"ok\") {\r\n");
      out.write("\t\t \t\t\t\tconfirmAgain();\r\n");
      out.write("\t\t\t\t\t} else {\r\n");
      out.write("\t\t\t\t\t\treturn;\r\n");
      out.write("\t\t\t\t\t}\r\n");
      out.write(" \t\t\t\t}\r\n");
      out.write(" \t\t);\r\n");
      out.write(" \t}\r\n");
      out.write(" \t\r\n");
      out.write("\t// 发票重打二次确认\r\n");
      out.write("\tfunction confirmAgain() {\r\n");
      out.write("\t\tmini.confirm(\r\n");
      out.write(" \t\t\t\t\"请再次确定是否要重打发票\",\r\n");
      out.write(" \t\t\t\t\"提示\",\r\n");
      out.write(" \t\t\t\tfunction(action) {\r\n");
      out.write("\t\t \t\t\tif (action == \"ok\") {\r\n");
      out.write("\t\t \t\t\t\tdoReprintReceipt();\r\n");
      out.write("\t\t\t\t\t} else {\r\n");
      out.write("\t\t\t\t\t\treturn;\r\n");
      out.write("\t\t\t\t\t}\r\n");
      out.write(" \t\t\t\t}\r\n");
      out.write(" \t\t);\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 执行发票重打\r\n");
      out.write("\tfunction doReprintReceipt() {\r\n");
      out.write("\t\tvar url = \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/opExpReceipt/rePrintReceipt.do\";\r\n");
      out.write("\t\tvar data = {\r\n");
      out.write("\t\t\tregisterId : registerId.value,\r\n");
      out.write("\t\t\toldReceiptId : receiptId.value,\r\n");
      out.write("\t\t\tinvoiceType : \"O\"\r\n");
      out.write("\t\t};\r\n");
      out.write("\t\t$.post(url, data , function(r) {\r\n");
      out.write("\t\t\treport.LoadFromURL(\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/report/template/opExpReceipt.grf?t=\"+new Date().getTime());\r\n");
      out.write("\t\t\tbtnPrint_onclick(r);\r\n");
      out.write("\t\t\treport.Print(false);\r\n");
      out.write("\t\t\t\r\n");
      out.write("\t\t\tclear();// 重打后清空页面\r\n");
      out.write("\t\t});\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 发票作废\r\n");
      out.write("\tfunction cancel() {\r\n");
      out.write("\t\tif(!receiptId.value) {\r\n");
      out.write(" \t\t\treturn;\r\n");
      out.write(" \t\t}\r\n");
      out.write("\t\tmini.confirm(\r\n");
      out.write(" \t\t\t\t\"确定要作废发票吗？\",\r\n");
      out.write(" \t\t\t\t\"提示\",\r\n");
      out.write(" \t\t\t\tfunction(action) {\r\n");
      out.write("\t\t \t\t\tif (action == \"ok\") {\r\n");
      out.write("\t\t \t\t\t\tconfirmCancel();\r\n");
      out.write("\t\t\t\t\t} else {\r\n");
      out.write("\t\t\t\t\t\treturn;\r\n");
      out.write("\t\t\t\t\t}\r\n");
      out.write(" \t\t\t\t}\r\n");
      out.write(" \t\t);\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 再次确认作废发票\r\n");
      out.write("\tfunction confirmCancel() {\r\n");
      out.write("\t\tmini.confirm(\r\n");
      out.write(" \t\t\t\t\"请再次确定是否要作废发票\",\r\n");
      out.write(" \t\t\t\t\"提示\",\r\n");
      out.write(" \t\t\t\tfunction(action) {\r\n");
      out.write("\t\t \t\t\tif (action == \"ok\") {\r\n");
      out.write("\t\t \t\t\t\treConfirmCancel();\r\n");
      out.write("\t\t\t\t\t} else {\r\n");
      out.write("\t\t\t\t\t\treturn;\r\n");
      out.write("\t\t\t\t\t}\r\n");
      out.write(" \t\t\t\t}\r\n");
      out.write(" \t\t);\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 不同情况下是否继续执行作废\r\n");
      out.write("\tfunction reConfirmCancel2333() {\r\n");
      out.write("\t\tvar flag = false;\r\n");
      out.write("\t\tvar rows = grid1.getList();\r\n");
      out.write("\t\tvar msg = \"\";\r\n");
      out.write("\t\tfor(var i = 0 ; i < rows.length ; i++) {\r\n");
      out.write("\t\t\tvar apply = rows[i];\r\n");
      out.write("\t\t\tif (apply.confirmQty > 0 && !flag) {// 确认量大于0\r\n");
      out.write("\t\t\t\tif(apply.itemSourceType == \"0\") {// 药品\r\n");
      out.write("\t\t\t\t\tmini.confirm(\r\n");
      out.write("\t\t\t \t\t\t\t\"此次结算【\" + apply.itemName + \"】已发药，是否继续作废发票？\",\r\n");
      out.write("\t\t\t \t\t\t\t\"提示\",\r\n");
      out.write("\t\t\t \t\t\t\tfunction(action) {\r\n");
      out.write("\t\t\t\t\t \t\t\tif (action == \"ok\") {\r\n");
      out.write("\t\t\t\t\t \t\t\t\tflag = true;\r\n");
      out.write("\t\t\t\t\t\t\t\t} else {\r\n");
      out.write("\t\t\t\t\t\t\t\t\treturn;\r\n");
      out.write("\t\t\t\t\t\t\t\t}\r\n");
      out.write("\t\t\t \t\t\t\t}\r\n");
      out.write("\t\t\t \t\t);\r\n");
      out.write("\t\t\t\t} else {// 非药品\r\n");
      out.write("\t\t\t\t\tmini.confirm(\r\n");
      out.write("\t\t\t \t\t\t\t\"此次结算【\" + apply.itemName + \"】已确认，是否继续作废发票？\",\r\n");
      out.write("\t\t\t \t\t\t\t\"提示\",\r\n");
      out.write("\t\t\t \t\t\t\tfunction(action) {\r\n");
      out.write("\t\t\t\t\t \t\t\tif (action == \"ok\") {\r\n");
      out.write("\t\t\t\t\t \t\t\t\tflag = true;\r\n");
      out.write("\t\t\t\t\t\t\t\t} else {\r\n");
      out.write("\t\t\t\t\t\t\t\t\treturn;\r\n");
      out.write("\t\t\t\t\t\t\t\t}\r\n");
      out.write("\t\t\t \t\t\t\t}\r\n");
      out.write("\t\t\t \t\t);\r\n");
      out.write("\t\t\t\t}\r\n");
      out.write("\t\t\t} else if(apply.nobackQty != apply.showQty && !flag) {// 可退量和收费量不相等\r\n");
      out.write("\t\t\t\tif(apply.itemSourceType == \"0\") {// 药品\r\n");
      out.write("\t\t\t\t\t/* mini.confirm(\r\n");
      out.write("\t\t\t \t\t\t\t\"此次结算【\" + apply.itemName + \"】已发退药申请，不允许作废发票\",\r\n");
      out.write("\t\t\t \t\t\t\t\"提示\",\r\n");
      out.write("\t\t\t \t\t\t\tfunction(action) {\r\n");
      out.write("\t\t\t\t\t \t\t\tif (action == \"ok\") {\r\n");
      out.write("\t\t\t\t\t \t\t\t\tflag = true;\r\n");
      out.write("\t\t\t\t\t\t\t\t} else {\r\n");
      out.write("\t\t\t\t\t\t\t\t\treturn;\r\n");
      out.write("\t\t\t\t\t\t\t\t}\r\n");
      out.write("\t\t\t \t\t\t\t}\r\n");
      out.write("\t\t\t \t\t); */\r\n");
      out.write("\t\t\t\t\tmini.alert(\"此次结算【\" + apply.itemName + \"】已发退药申请，不允许作废发票\");\r\n");
      out.write("\t\t\t\t\treturn;\r\n");
      out.write("\t\t\t\t} else {// 非药品\r\n");
      out.write("\t\t\t\t\t/* mini.confirm(\r\n");
      out.write("\t\t\t \t\t\t\t\"此次结算【\" + apply.itemName + \"】已发退费申请，不允许作废发票\",\r\n");
      out.write("\t\t\t \t\t\t\t\"提示\",\r\n");
      out.write("\t\t\t \t\t\t\tfunction(action) {\r\n");
      out.write("\t\t\t\t\t \t\t\tif (action == \"ok\") {\r\n");
      out.write("\t\t\t\t\t \t\t\t\tflag = true;\r\n");
      out.write("\t\t\t\t\t\t\t\t} else {\r\n");
      out.write("\t\t\t\t\t\t\t\t\treturn;\r\n");
      out.write("\t\t\t\t\t\t\t\t}\r\n");
      out.write("\t\t\t \t\t\t\t}\r\n");
      out.write("\t\t\t \t\t); */\r\n");
      out.write("\t\t\t\t\tmini.alert(\"此次结算【\" + apply.itemName + \"】已发退费申请，不允许作废发票\");\r\n");
      out.write("\t\t\t\t\treturn;\r\n");
      out.write("\t\t\t\t}\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\t\r\n");
      out.write("\t\tif(flag) {\r\n");
      out.write("\t\t\tcancelReceipt();\r\n");
      out.write("\t\t}\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 不同情况下是否继续执行作废\r\n");
      out.write("\tfunction reConfirmCancel() {\r\n");
      out.write("\t\tvar flag = true;\r\n");
      out.write("\t\tvar rows = grid1.getList();\r\n");
      out.write("\t\tvar msg = \"\";\r\n");
      out.write("\t\tfor(var i = 0 ; i < rows.length ; i++) {\r\n");
      out.write("\t\t\tvar apply = rows[i];\r\n");
      out.write("\t\t\tif (apply.confirmQty > 0) {// 确认量大于0\r\n");
      out.write("\t\t\t\tif(apply.itemSourceType == \"0\") {// 药品\r\n");
      out.write("\t\t\t\t\tmsg = msg + \"此次结算【\" + apply.itemName + \"】已发药，是否继续作废发票？</br>\"\r\n");
      out.write("\t\t\t\t\tflag = false;\r\n");
      out.write("\t\t\t\t} else {// 非药品\r\n");
      out.write("\t\t\t\t\tmsg = msg + \"此次结算【\" + apply.itemName + \"】已确认，是否继续作废发票？</br>\"\r\n");
      out.write("\t\t\t\t\tflag = false;\r\n");
      out.write("\t\t\t\t}\r\n");
      out.write("\t\t\t} else if(apply.nobackQty != apply.showQty) {// 可退量和收费量不相等\r\n");
      out.write("\t\t\t\tif(apply.itemSourceType == \"0\") {// 药品\r\n");
      out.write("\t\t\t\t\tmini.alert(\"此次结算【\" + apply.itemName + \"】已发退药申请，不允许作废发票\");\r\n");
      out.write("\t\t\t\t\treturn;\r\n");
      out.write("\t\t\t\t} else {// 非药品\r\n");
      out.write("\t\t\t\t\tmini.alert(\"此次结算【\" + apply.itemName + \"】已发退费申请，不允许作废发票\");\r\n");
      out.write("\t\t\t\t\treturn;\r\n");
      out.write("\t\t\t\t}\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\t\r\n");
      out.write("\t\tif(flag) {\r\n");
      out.write("\t\t\tcancelReceipt();\r\n");
      out.write("\t\t} else {\r\n");
      out.write("\t\t\tmini.confirm(\r\n");
      out.write("\t\t\t\t\tmsg,\r\n");
      out.write("\t \t\t\t\t\"提示\",\r\n");
      out.write("\t \t\t\t\tfunction(action) {\r\n");
      out.write("\t\t\t \t\t\tif (action == \"ok\") {\r\n");
      out.write("\t\t\t \t\t\t\tcancelReceipt();\r\n");
      out.write("\t\t\t\t\t\t} else {\r\n");
      out.write("\t\t\t\t\t\t\treturn;\r\n");
      out.write("\t\t\t\t\t\t}\r\n");
      out.write("\t \t\t\t\t}\r\n");
      out.write("\t \t\t);\r\n");
      out.write("\t\t}\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 执行发票作废\r\n");
      out.write("\tfunction cancelReceipt() {\r\n");
      out.write("\t\tvar url = \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/opExpReceipt/cancel.do\";\r\n");
      out.write("\t\tvar data = {\r\n");
      out.write("\t\t\tregisterId : registerId.value,\r\n");
      out.write("\t\t\tbalanceId : balanceId.value\r\n");
      out.write("\t\t};\r\n");
      out.write("\t\t$.post(url, data , function(r) {\r\n");
      out.write("\t\t\tif(r == \"ok\") {\r\n");
      out.write("\t\t\t\ttop.mini.alert(\"发票作废成功！\")\r\n");
      out.write("\t\t\t\tclear();\r\n");
      out.write("\t\t\t\treturn;\r\n");
      out.write("\t\t\t} else {\r\n");
      out.write("\t\t\t\ttop.mini.error(r);\r\n");
      out.write("\t\t\t}\r\n");
      out.write("\t\t});\t\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 结算单打印（按费用类别打印）\r\n");
      out.write("\tfunction getApplyPrintList() {\r\n");
      out.write("\t\tif(!registerId.value || !balanceId.value) {\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\t\r\n");
      out.write("\t\t// 获取结算单打印数据\r\n");
      out.write("\t\tvar data = {\r\n");
      out.write("\t\t\tregisterId : registerId.value,\r\n");
      out.write("\t\t\tbalanceId : balanceId.value\r\n");
      out.write("\t\t};\r\n");
      out.write("\t\tvar url = \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/radt/opRegister/getApplyPrintList.do\";\r\n");
      out.write("\t\t$.post(url, data , function(r) {\r\n");
      out.write("\t\t\tdoPrintApplyList(r);\r\n");
      out.write("\t\t});\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 执行结算单打印\r\n");
      out.write("\tfunction doPrintApplyList(r) {\r\n");
      out.write("\t\tReport.LoadFromURL(\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/report/template/opApplyList.grf?t=\" + new Date().getTime());\r\n");
      out.write("\t\tReport.PrepareLoadData();\r\n");
      out.write("\t\t\r\n");
      out.write("\t\tReport.ParameterByName(\"regId\").AsString = mini.formatDate(mini.parseDate(receiptTime.value) , \"yyyyMMdd\") + dailySerialId.value;\r\n");
      out.write("\t\tReport.ParameterByName(\"invoiceNo\").AsString = invoiceNo.value;\r\n");
      out.write("\t\tReport.ParameterByName(\"receiptTime\").AsString = mini.formatDate(mini.parseDate(receiptTime.value) , \"yyyy-MM-dd\");\r\n");
      out.write("\t\tReport.ParameterByName(\"seeDeptName\").AsString = seeDeptName.value;\r\n");
      out.write("\t\tReport.ParameterByName(\"patientName\").AsString = patientName.value;\r\n");
      out.write("\t\tReport.ParameterByName(\"sex\").AsString = sexCode.text;\r\n");
      out.write("\t\tReport.ParameterByName(\"age\").AsString = age.value;\r\n");
      out.write("\t\tReport.ParameterByName(\"medicaltypeName\").AsString = patientMedicaltypeId.text;\r\n");
      out.write("\t\t\r\n");
      out.write("\t\tvar sumCost = 0.00;\r\n");
      out.write("\t\tfor(var i = 0 ; i < r.length ; i++) {\r\n");
      out.write("\t\t\tReport.DetailGrid.Recordset.Append();\r\n");
      out.write("\t\t\t\r\n");
      out.write("\t\t\tReport.FieldByName(\"itemNo\").Value = r[i].itemNo;\r\n");
      out.write("\t\t\tReport.FieldByName(\"itemName\").Value = r[i].itemName;\r\n");
      out.write("\t\t\tReport.FieldByName(\"showQty\").Value = r[i].showQty;\r\n");
      out.write("\t\t\tReport.FieldByName(\"showUnit\").Value = r[i].showUnit;\r\n");
      out.write("\t\t\tReport.FieldByName(\"price\").Value = r[i].price;\r\n");
      out.write("\t\t\tReport.FieldByName(\"totCost\").Value = r[i].totCost.toFixed(2) + \"\";\r\n");
      out.write("\t\t\tReport.FieldByName(\"itemFeeName\").Value = r[i].itemFeeName;\r\n");
      out.write("\t\t\tReport.FieldByName(\"identification\").Value = r[i].identification;\r\n");
      out.write("\t\t\t\r\n");
      out.write("\t\t\tsumCost += r[i].totCost;\r\n");
      out.write("\t\t\t\r\n");
      out.write("\t\t\tReport.DetailGrid.Recordset.Post();\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tReport.ParameterByName(\"sumCost\").AsString = sumCost.toFixed(2) + \"\";\r\n");
      out.write("\t\t\r\n");
      out.write("// \t\treport.Print(false);\r\n");
      out.write("\t\tReport.PrintPreview(true);\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 清单打印\r\n");
      out.write("\tfunction printApplyList() {\r\n");
      out.write("\t\tvar rows = grid1.getList();\r\n");
      out.write("\t\tif(rows.length == 0) {\r\n");
      out.write("\t\t\treturn;\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tmini.confirm(\r\n");
      out.write(" \t\t\t\t\"确定要打印门诊清单吗？\",\r\n");
      out.write(" \t\t\t\t\"提示\",\r\n");
      out.write(" \t\t\t\tfunction(action) {\r\n");
      out.write("\t\t \t\t\tif (action == \"ok\") {\r\n");
      out.write("\t\t \t\t\t\tgetPrintList();// 获取清单打印数据\r\n");
      out.write("\t\t\t\t\t} else {\r\n");
      out.write("\t\t\t\t\t\treturn;\r\n");
      out.write("\t\t\t\t\t}\r\n");
      out.write(" \t\t\t\t}\r\n");
      out.write(" \t\t);\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 获取清单打印数据\r\n");
      out.write("\tfunction getPrintList() {\r\n");
      out.write("\t\tvar data = {\r\n");
      out.write("\t\t\tregisterId : registerId.value,\r\n");
      out.write("\t\t\tbalanceId : balanceId.value\r\n");
      out.write("\t\t};\r\n");
      out.write("\t\tvar url = \"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/radt/opRegister/getPrintList.do\";\r\n");
      out.write("\t\t$.post(url, data , function(r) {\r\n");
      out.write("\t\t\tdoPrintChargeList(r);\r\n");
      out.write("\t\t});\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\t// 执行清单打印\r\n");
      out.write("\tfunction doPrintChargeList(r) {\r\n");
      out.write("\t\tReport.LoadFromURL(\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/report/template/opChargeList.grf?t=\" + new Date().getTime());\r\n");
      out.write("\t\tReport.PrepareLoadData();\r\n");
      out.write("\t\t\r\n");
      out.write("\t\tReport.ParameterByName(\"regId\").AsString = mini.formatDate(mini.parseDate(receiptTime.value) , \"yyyyMMdd\") + dailySerialId.value;\r\n");
      out.write("\t\tReport.ParameterByName(\"invoiceNo\").AsString = invoiceNo.value;\r\n");
      out.write("\t\tReport.ParameterByName(\"receiptTime\").AsString = mini.formatDate(mini.parseDate(receiptTime.value) , \"yyyy-MM-dd\");\r\n");
      out.write("\t\tReport.ParameterByName(\"seeDeptName\").AsString = seeDeptName.value;\r\n");
      out.write("\t\tReport.ParameterByName(\"patientName\").AsString = patientName.value;\r\n");
      out.write("\t\tReport.ParameterByName(\"sex\").AsString = sexCode.text;\r\n");
      out.write("\t\tReport.ParameterByName(\"age\").AsString = age.value;\r\n");
      out.write("\t\tReport.ParameterByName(\"medicaltypeName\").AsString = patientMedicaltypeId.text;\r\n");
      out.write("// \t\tReport.ParameterByName(\"xxxxx\").AsString = xxxx;\r\n");
      out.write("\t\t\r\n");
      out.write("\t\tvar itemNo  = Report.FieldByName(\"itemNo\");\r\n");
      out.write("\t\tvar itemName  = Report.FieldByName(\"itemName\");\r\n");
      out.write("\t\tvar showQty  = Report.FieldByName(\"showQty\");\r\n");
      out.write("\t\tvar showUnit  = Report.FieldByName(\"showUnit\");\r\n");
      out.write("\t\tvar price  = Report.FieldByName(\"price\");\r\n");
      out.write("\t\tvar totCost  = Report.FieldByName(\"totCost\");\r\n");
      out.write("\t\tvar itemFeeName  = Report.FieldByName(\"itemFeeName\");\r\n");
      out.write("\t\tvar identification  = Report.FieldByName(\"identification\");\r\n");
      out.write("\t\t\r\n");
      out.write("\t\tvar sumCost = 0.00;\r\n");
      out.write("\t\tfor(var i = 0 ; i < r.length ; i++) {\r\n");
      out.write("\t\t\tReport.DetailGrid.Recordset.Append();\r\n");
      out.write("\t\t\t\r\n");
      out.write("\t\t\titemNo.Value = r[i].itemNo;\r\n");
      out.write("\t\t\titemName.Value = r[i].itemName;\r\n");
      out.write("\t\t\tshowQty.Value = r[i].showQty;\r\n");
      out.write("\t\t\tshowUnit.Value = r[i].showUnit;\r\n");
      out.write("\t\t\tprice.Value = r[i].price;\r\n");
      out.write("\t\t\ttotCost.Value = r[i].totCost.toFixed(2) + \"\";\r\n");
      out.write("\t\t\titemFeeName.Value = r[i].itemFeeName;\r\n");
      out.write("\t\t\tidentification.Value = r[i].identification;\r\n");
      out.write("\t\t\t\r\n");
      out.write("\t\t\tsumCost += r[i].totCost;\r\n");
      out.write("\t\t\t\r\n");
      out.write("\t\t\tReport.DetailGrid.Recordset.Post();\r\n");
      out.write("\t\t}\r\n");
      out.write("\t\tReport.ParameterByName(\"sumCost\").AsString = sumCost.toFixed(2) + \"\";\r\n");
      out.write("\t\t\r\n");
      out.write("// \t\treport.Print(false);\r\n");
      out.write("\t\tReport.PrintPreview(true);\r\n");
      out.write("\t}\r\n");
      out.write(" \t\r\n");
      out.write("\tfunction show() {\r\n");
      out.write("\t\t$(\".hideBegin\").show();\r\n");
      out.write("\t}\r\n");
      out.write("\t\r\n");
      out.write("\tvar sexType = [{id:\"1\",text:\"男\"}, {id:\"2\",text:\"女\"}];\r\n");
      out.write(" \t\r\n");
      out.write("</script>\r\n");
      out.write("</head>\r\n");
      out.write("<body>\r\n");
      out.write("\t<div id=\"form0\" class=\"mini-toolbar hideBegin\" style=\"display:none;\" borderStyle=\"border-top:0;border-right:1;border-left:1;border-bottom:1;\">\r\n");
      out.write("\t\t<span id=\"text01\" style=\"font-size:14px;color:#006aad;font-weight:bold;\">当日号</span>\r\n");
      out.write("\t\t<span>:</span>\r\n");
      out.write("\t\t<input id=\"key\" class=\"mini-textbox\" emptyText=\"按F2切换检索条件\" width=\"150\" onenter=\"queryOpExpRegister\"/>\r\n");
      out.write("\t\t<span>系列号:</span>\r\n");
      out.write("\t\t<input id=\"receiptId\" class=\"mini-textbox\" emptyText=\"收据ID\" onenter=\"getByReceiptId\"/>\r\n");
      out.write("\t\t<span>发票号:</span>\r\n");
      out.write("\t\t<input id=\"receiptNo\" class=\"mini-textbox\" onenter=\"getByReceiptNo\"/>\r\n");
      out.write("\t\t<a class=\"mini-button\" iconCls=\"\" onclick=\"cancel\">发票作废</a>\r\n");
      out.write("\t\t<a class=\"mini-button\" iconCls=\"\" onclick=\"previewInvoice\">发票预览</a>\r\n");
      out.write("\t\t<a class=\"mini-button\" iconCls=\"\" onclick=\"printReceipt\">发票补打</a>\r\n");
      out.write("\t\t<span class=\"separator\"></span>\r\n");
      out.write("\t\t<a class=\"mini-button\" iconCls=\"\" onclick=\"reprintReceipt\">发票重打</a>\r\n");
      out.write("\t\t<a class=\"mini-button\" iconCls=\"\" onclick=\"getApplyPrintList\">结算单</a>\r\n");
      out.write("\t\t<a class=\"mini-button\" iconCls=\"\" onclick=\"printApplyList\">清单打印</a>\r\n");
      out.write("\t\t<a class=\"mini-button\" iconCls=\"\" onclick=\"clear\">清空</a>\r\n");
      out.write("\t\t<input id=\"receiptId\" name=\"receiptId\" class=\"mini-hidden\"/>\r\n");
      out.write("\t\t<input id=\"invoiceNo\" name=\"invoiceNo\" class=\"mini-hidden\"/>\r\n");
      out.write("\t\t<input id=\"receiptTime\" name=\"receiptTime\" class=\"mini-hidden\"/>\r\n");
      out.write("\t</div>\r\n");
      out.write("\t<div id=\"form1\" class=\"mini-toolbar hideBegin\" style=\"display:none;\" borderStyle=\"border-top:0px;border-left:1;border-right:1;border-bottom:1\">\r\n");
      out.write("\t\t<input id=\"patientId\" name=\"patientId\" class=\"mini-hidden\"/>\r\n");
      out.write("\t\t<input id=\"balanceId\" name=\"balanceId\" class=\"mini-hidden\" readOnly=\"true\"/>\r\n");
      out.write("\t\t<input id=\"registerId\" name=\"registerId\" class=\"mini-hidden\" readOnly=\"true\"/>\r\n");
      out.write("\t\t<input id=\"seeDeptName\" name=\"seeDeptName\" class=\"mini-hidden\"/>\r\n");
      out.write("\t\t<input id=\"dailySerialId\" name=\"dailySerialId\" class=\"mini-hidden\"/>\r\n");
      out.write("\t\t<table border=\"0\" cellspacing=\"0\">\r\n");
      out.write("\t\t\t<tr>\r\n");
      out.write("\t\t\t\t<td class=\"form-label required\" style=\"width:100px;\">姓名：</td>\r\n");
      out.write("\t\t\t\t<td>\r\n");
      out.write("\t\t\t\t\t<input id=\"patientName\" name=\"patientName\" class=\"mini-textbox\" allowInput=\"false\"/>\r\n");
      out.write("\t\t\t\t</td>\r\n");
      out.write("\t\t\t\t<td class=\"form-label required\" style=\"width:100px;\">出生日期：</td>\r\n");
      out.write("\t\t\t\t<td><input name=\"birthDate\" class=\"mini-datepicker\" enabled=\"false\"/></td>\r\n");
      out.write("\t\t\t\t<td class=\"form-label required\" style=\"width:60px;\">性别：</td>\r\n");
      out.write("\t\t\t\t<td width=\"100\">\r\n");
      out.write("\t\t\t\t\t<input id=\"sexCode\" name=\"sexCode\" class=\"mini-combobox\" style=\"width:40px;\" enabled=\"false\" data=\"[{id:'1',text:'男'}, {id:'2',text:'女'}]\"/>\r\n");
      out.write("\t\t\t\t</td>\r\n");
      out.write("\t\t\t\t<td class=\"form-label required\" style=\"width:50px;\">年龄：</td>\r\n");
      out.write("\t\t\t\t<td colspan=\"2\">\r\n");
      out.write("\t\t\t\t\t<input id=\"age\" name=\"age\" class=\"mini-textbox\" style=\"width:40px;\" allowInput=\"false\"/>\r\n");
      out.write("\t\t\t\t</td>\r\n");
      out.write("\t\t\t\t<td class=\"form-label\" style=\"width:100px;\">诊断信息：</td>\r\n");
      out.write("\t\t\t\t<td class=\"blue-weight\" width=\"500px;\">\r\n");
      out.write("\t\t\t\t\t<span id=\"diagName\">无</span>\r\n");
      out.write("\t\t\t\t</td>\r\n");
      out.write("\t\t\t</tr>\r\n");
      out.write("\t\t\t<tr>\r\n");
      out.write("\t\t\t\t<td class=\"form-label\">证件类型：</td>\r\n");
      out.write("\t\t\t\t<td>\r\n");
      out.write("\t\t\t\t\t<input name=\"idnetifierTypeId\" class=\"mini-combobox\" enabled=\"false\"\r\n");
      out.write("\t\t\t\t\t\turl=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/platform/system/sysDict/getKVs.do?dictType=BD_IDENTIFIER_TYPE\"/>\r\n");
      out.write("\t\t\t\t</td>\r\n");
      out.write("\t\t\t\t<td class=\"form-label\">证件号：</td>\r\n");
      out.write("\t\t\t\t<td colspan=\"2\"><input name=\"idnetifierNo\" class=\"mini-textbox\" style=\"width:180px;\" allowInput=\"false\"/></td>\r\n");
      out.write("\t\t\t\t<td class=\"form-label\" style=\"width:80px;\">电话：</td>\r\n");
      out.write("\t\t\t\t<td colspan=\"3\"><input name=\"phone\" class=\"mini-textbox\" style=\"width:150px;\" allowInput=\"false\"/></td>\r\n");
      out.write("\t\t\t\t<td class=\"form-label\">门慢信息：</td>\r\n");
      out.write("\t\t\t\t<td class=\"blue-weight\">\r\n");
      out.write("\t\t\t\t\t<a href=\"#\" onclick=\"openChronicInfo()\"><span id=\"chronicDiseaseText\">无</span></a>\r\n");
      out.write("\t\t\t\t\t<input id=\"chronicDiseaseId\" name=\"chronicDiseaseId\" class=\"mini-combobox\" visible=\"false\" \r\n");
      out.write("\t\t\t\t\t\turl=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/platform/system/sysDict/getKVs.do?dictType=BD_DRUGSILIMITMM\"/>\r\n");
      out.write("\t\t\t\t</td>\r\n");
      out.write("\t\t\t</tr>\r\n");
      out.write("\t\t\t<tr>\r\n");
      out.write("\t\t\t\t<td class=\"form-label required\">结算类别：</td>\r\n");
      out.write("\t\t\t\t<td>\r\n");
      out.write("\t\t\t\t\t<input id=\"patientMedicaltypeId\" name=\"patientMedicaltypeId\" class=\"mini-combobox\" enabled=\"false\"\r\n");
      out.write("\t\t\t\t\t\turl=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/common/medicalType/getChildKVs.do\"/>\r\n");
      out.write("\t\t\t\t</td>\r\n");
      out.write("\t\t\t\t<td class=\"form-label required\">结算种类：</td>\r\n");
      out.write("\t\t\t\t<td colspan=\"2\">\r\n");
      out.write("\t\t\t\t\t<input name=\"patientMedicaltypeKind\" class=\"mini-combobox\" style=\"width:180px;\" enabled=\"false\"\r\n");
      out.write("\t\t\t\t\t\turl=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/common/medicalTypeKind/getKVs.do\"/>\r\n");
      out.write("\t\t\t\t</td>\r\n");
      out.write("\t\t\t\t<td class=\"form-label\">医疗证号：</td>\r\n");
      out.write("\t\t\t\t<td colspan=\"3\">\r\n");
      out.write("\t\t\t\t\t<input name=\"medicalCertificateNo\" class=\"mini-textbox\" style=\"width:150px;\" allowInput=\"false\"/>\r\n");
      out.write("\t\t\t\t</td>\r\n");
      out.write("\t\t\t\t<td class=\"form-label\">结算信息：</td>\r\n");
      out.write("\t\t\t\t<td class=\"blue-weight\">\r\n");
      out.write("\t\t\t\t\t<span id=\"outpayRate\">无</span>\r\n");
      out.write("\t\t\t\t</td>\r\n");
      out.write("\t\t\t</tr>\r\n");
      out.write("\t\t</table>\r\n");
      out.write("\t</div>\t\r\n");
      out.write("\t<div class=\"mini-toolbar hideBegin\" borderStyle=\"border-top:0px;border-left:1;border-right:1;border-bottom:solid 1px #c5c5c5;\" \r\n");
      out.write("\t\tstyle=\"font-size:10px; display:none; height:15px; line-height: 15px;\" >\r\n");
      out.write("\t\t项目信息\t\r\n");
      out.write("\t</div>\r\n");
      out.write("\t<div class=\"mini-toolbar hideBegin\" id=\"divBref\" borderStyle=\"border-top:0px;border-left:1;border-right:1;border-bottom:solid 1px #c5c5c5;\" \r\n");
      out.write("\t\tstyle=\"font-size:20px; height:30px; line-height: 15px;display:none;\" >\r\n");
      out.write("\t\t<span id=\"textBref\" style=\"font-size:20px;color:#006aad;font-weight:bold;\"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n");
      out.write("\t</div>\r\n");
      out.write("\t<div class=\"mini-fit\">\r\n");
      out.write("\t\t<div id=\"grid1\" class=\"mini-datagrid\" style=\"width:1500px;height:100%;\" borderStyle=\"border:0\" onload=\"onLoad\" allowCellEdit=\"false\" allowCellSelect=\"false\" \r\n");
      out.write("\t\t\tshowPager=\"false\" multiSelect=\"false\" onlyCheckSelection=\"true\" idField=\"id\" allowResize=\"false\"  \r\n");
      out.write("\t\t\t\tondrawgroup=\"onDrawGroup\" url=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/expense/outpatient/fee/outFeeCancel/getApplys.do\">\r\n");
      out.write("        \t<div property=\"columns\">\r\n");
      out.write("        \t\t<div type=\"indexcolumn\" width=\"30\"></div>\r\n");
      out.write("        \t\t<div field=\"orderGroupNo\" headerAlign=\"center\" align=\"center\" width=\"30\">组号</div> \r\n");
      out.write("        \t\t<div field=\"itemNo\" headerAlign=\"center\" align=\"center\" width=\"80\">编码</div>\r\n");
      out.write("        \t\t<div field=\"itemName\" headerAlign=\"center\" align=\"center\" width=\"300\" renderer=\"drugNameRenderer\">名称</div>\r\n");
      out.write("        \t\t<div field=\"comb\" headerAlign=\"center\" align=\"center\" width=\"30\">.</div>\r\n");
      out.write("        \t\t<div field=\"orderCombId\" visible=\"false\">组合号</div>\r\n");
      out.write("        \t\t<div field=\"price\" headerAlign=\"center\" align=\"center\" renderer=\"priceRenderer\" width=\"60\">单价</div>\r\n");
      out.write("\t\t\t\t<div field=\"showQty\" headerAlign=\"center\" align=\"center\" width=\"60\">收费量</div>\r\n");
      out.write("        \t\t<div field=\"confirmQty\" headerAlign=\"center\" align=\"center\" width=\"60\">确认量</div>\r\n");
      out.write("        \t\t<!-- <div field=\"xxx\" headerAlign=\"center\" align=\"center\" width=\"60\">已退量</div> -->\r\n");
      out.write("        \t\t<div field=\"nobackQty\" headerAlign=\"center\" align=\"center\" width=\"60\">可退量</div>\r\n");
      out.write("        \t\t<div field=\"showUnit\" headerAlign=\"center\" align=\"center\" width=\"60\">单位</div>\r\n");
      out.write("        \t\t<div field=\"executeDeptId\" headerAlign=\"center\" align=\"center\" type=\"comboboxcolumn\" readOnly=\"true\" width=\"130\">执行科室\r\n");
      out.write("        \t\t\t<input property=\"editor\" class=\"mini-combobox\" style=\"width:100%;\" url=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/platform/system/sysOrg/getKVs.do\"/>\r\n");
      out.write("        \t\t</div>\r\n");
      out.write("        \t\t<div field=\"tag.identification\" headerAlign=\"center\" align=\"center\">标识</div>\r\n");
      out.write("        \t\t<div field=\"totCost\" headerAlign=\"center\" align=\"center\" width=\"60\">金额</div>\r\n");
      out.write("        \t\t<div field=\"orderBillId\" visible=\"false\">处方号(隐藏)</div>\r\n");
      out.write("        \t\t<div field=\"itemId\" visible=\"false\">项目ID(隐藏)</div>\r\n");
      out.write("        \t\t<div field=\"applyId\" visible=\"false\">门诊记账申请ID(隐藏)</div>\r\n");
      out.write("        \t\t<div field=\"itemSourceType\" visible=\"false\">项目来源类别-0药品,1非药品(隐藏)</div>\r\n");
      out.write("        \t\t<div field=\"itemSourceId\" visible=\"false\">项目来源ID(隐藏)</div>\r\n");
      out.write("        \t\t<div field=\"itemFeeType\" visible=\"false\">费用类别(隐藏)</div>\r\n");
      out.write("        \t\t<div field=\"applyDeptId\" visible=\"false\">申请科室ID(隐藏)</div>\r\n");
      out.write("        \t\t<div field=\"recipeDoctId\" visible=\"false\">开方医生ID(隐藏)</div>\r\n");
      out.write("        \t\t<div field=\"needConfirmFlag\" visible=\"false\">需要确认标记(隐藏)</div>\r\n");
      out.write("        \t\t<div field=\"confirmFlag\" visible=\"false\">确认标记(隐藏)</div>\r\n");
      out.write("        \t\t<div field=\"orderId\" visible=\"false\">医嘱项目流水号(隐藏)</div>\r\n");
      out.write("        \t\t<div field=\"balanceFlag\" visible=\"false\">结算标记(隐藏)</div>\r\n");
      out.write("        \t\t<div field=\"stockDeptId\" visible=\"false\">领药科室ID(隐藏)</div>\r\n");
      out.write("        \t</div>\r\n");
      out.write("        </div>\r\n");
      out.write("\t</div>\r\n");
      out.write("\t<!-- 挂号记录/重复姓名 共用弹框 -->\r\n");
      out.write("\t<div id=\"win1\" title=\"选择患者信息 \" class=\"mini-window\" style=\"width:1000px;height:300px;display:none;\">\r\n");
      out.write("\t\t<div id=\"grid2\" class=\"mini-datagrid\" style=\"width:100%;height:100%;\" borderStyle=\"border:0\" allowCellEdit=\"false\" \r\n");
      out.write("\t\t\tonrowdblclick=\"queryData\" showPager=\"false\" multiSelect=\"false\" idField=\"id\" allowResize=\"false\">\r\n");
      out.write("        \t<div property=\"columns\">\r\n");
      out.write("        \t\t<div field=\"patientId\" headerAlign=\"center\" align=\"center\" width=\"70\">唯一号</div> \r\n");
      out.write("        \t\t<div field=\"patientName\" headerAlign=\"center\" align=\"center\" width=\"60\">患者姓名</div> \r\n");
      out.write("        \t\t<div field=\"sexCode\" headerAlign=\"center\" align=\"center\" width=\"30\" type=\"comboboxcolumn\">性别\r\n");
      out.write("        \t\t\t<input property=\"editor\" class=\"mini-combobox\" style=\"width:100%;\" data=\"sexType\"/>\r\n");
      out.write("        \t\t</div> \r\n");
      out.write("        \t\t<div field=\"age\" headerAlign=\"center\" align=\"center\" width=\"40\">年龄</div> \r\n");
      out.write("        \t\t<div field=\"idnetifierTypeId\" headerAlign=\"center\" align=\"center\" width=\"60\" type=\"comboboxcolumn\">号码类型\r\n");
      out.write("        \t\t\t<input property=\"editor\" class=\"mini-combobox\" style=\"width:100%;\" \r\n");
      out.write("\t\t\t \t\t\turl=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/platform/system/sysDict/getKVs.do?dictType=BD_IDENTIFIER_TYPE\"/>\r\n");
      out.write("        \t\t</div> \r\n");
      out.write("        \t\t<div field=\"idnetifierNo\" headerAlign=\"center\" align=\"center\">号码</div> \r\n");
      out.write("        \t\t<div field=\"phone\" headerAlign=\"center\" align=\"center\" width=\"70\">电话</div> \r\n");
      out.write("        \t\t<div field=\"registerDeptId\" headerAlign=\"center\" align=\"center\" type=\"comboboxcolumn\">科室\r\n");
      out.write("        \t\t\t<input property=\"editor\" class=\"mini-combobox\" style=\"width:100%;\" url=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${ctx}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("/platform/system/sysOrg/getKVs.do\"/>\r\n");
      out.write("        \t\t</div> \r\n");
      out.write("        \t\t<div field=\"registerTime\" headerAlign=\"center\" align=\"center\">挂号日期</div> \r\n");
      out.write("        \t\t<div field=\"registerId\" visible=\"false\">registerId(隐藏)</div>\r\n");
      out.write("        \t</div>\r\n");
      out.write("        </div>\r\n");
      out.write("\t</div>\r\n");
      out.write("\t<!-- 选择发票弹出框 -->\r\n");
      out.write("\t<div id=\"win2\" title=\"请选择结算信息\" class=\"mini-window\" style=\"width:800px;height:300px; display:none;\">\r\n");
      out.write("\t\t<div id=\"grid3\" class=\"mini-datagrid\" style=\"width:100%;height:100%;\" borderStyle=\"border:0\" allowCellEdit=\"false\" \r\n");
      out.write("\t\t\tonrowdblclick=\"getByReceipt\" showPager=\"false\" multiSelect=\"false\" idField=\"id\" allowResize=\"false\" showColumns=\"false\">\r\n");
      out.write("        \t<div property=\"columns\">\r\n");
      out.write("        \t\t<div field=\"receiptBref\" width=\"700px\">收据简要信息</div> \r\n");
      out.write("        \t\t<div field=\"balanceId\" visible=\"false\">结算ID(隐藏)</div>\r\n");
      out.write("        \t\t<div field=\"registerId\" visible=\"false\">门诊流水号(隐藏)</div>\r\n");
      out.write("        \t\t<div field=\"receiptId\" visible=\"false\">收据ID(隐藏)</div>\r\n");
      out.write("        \t\t<div field=\"invoiceNo\" visible=\"false\">发票号(隐藏)</div>\r\n");
      out.write("        \t\t<div field=\"receiptTime\" visible=\"false\">收据日期(隐藏)</div>\r\n");
      out.write("        \t</div>\r\n");
      out.write("        </div>\r\n");
      out.write("\t</div>\r\n");
      out.write("\t\r\n");
      out.write("\t<div style=\"display:block;margin-top:-16\">\r\n");
      out.write("\t\t<script type=\"text/javascript\">\r\n");
      out.write("\t\t\tCreateReport(\"Report\");\r\n");
      out.write("\t\t</script>\r\n");
      out.write("\t</div>\r\n");
      out.write("\t\r\n");
      out.write("\t<script type=\"text/javascript\">\r\n");
      out.write("\t\tmini.parse();\r\n");
      out.write("\t\tvar key = mini.get(\"key\");// F2检索框\r\n");
      out.write("\t\tvar receiptId = mini.get(\"receiptId\");\r\n");
      out.write("\t\tvar receiptNo = mini.get(\"receiptNo\");\r\n");
      out.write("\t\tvar form0 = new mini.Form(\"#form0\");\r\n");
      out.write("\t\tvar form1 = new mini.Form(\"#form1\");\r\n");
      out.write("\t\tvar patientId = mini.get(\"patientId\");\r\n");
      out.write("\t\tvar patientName = mini.get(\"patientName\");\r\n");
      out.write("\t\tvar sexCode = mini.get(\"sexCode\");\r\n");
      out.write("\t\tvar age = mini.get(\"age\");\r\n");
      out.write("\t\tvar registerId = mini.get(\"registerId\");\r\n");
      out.write("\t\tvar balanceId = mini.get(\"balanceId\");\r\n");
      out.write("\t\tvar chronicDiseaseId = mini.get(\"chronicDiseaseId\");\r\n");
      out.write("\t\tvar invoiceId = mini.get(\"invoiceId\");\r\n");
      out.write("\t\tvar grid1 = mini.get(\"grid1\");\r\n");
      out.write("\t\tvar win1 = mini.get(\"win1\");\r\n");
      out.write("\t\tvar grid2 = mini.get(\"grid2\");\r\n");
      out.write("\t\tvar win2 = mini.get(\"win2\");\r\n");
      out.write("\t\tvar grid3 = mini.get(\"grid3\");\r\n");
      out.write("\t\tvar medicaltype = mini.get(\"patientMedicaltypeId\");\r\n");
      out.write("\t\tvar receiptId = mini.get(\"receiptId\");\r\n");
      out.write("\t\tvar invoiceNo = mini.get(\"invoiceNo\");\r\n");
      out.write("\t\tvar receiptTime = mini.get(\"receiptTime\");\r\n");
      out.write("\t\tvar seeDeptName = mini.get(\"seeDeptName\");\r\n");
      out.write("\t\tvar dailySerialId = mini.get(\"dailySerialId\");\r\n");
      out.write("\t\tvar patientMedicaltypeId = mini.get(\"patientMedicaltypeId\");\r\n");
      out.write("\t\tvar report = document.getElementById(\"Report\");\r\n");
      out.write("\t\tshow();\r\n");
      out.write("\t\t\r\n");
      out.write("\t\t\r\n");
      out.write("\t</script>\r\n");
      out.write("</body>\r\n");
      out.write("</html>\r\n");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try {
            if (response.isCommitted()) {
              out.flush();
            } else {
              out.clearBuffer();
            }
          } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }

  private boolean _jspx_meth_c_005fset_005f0(javax.servlet.jsp.PageContext _jspx_page_context)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  c:set
    org.apache.taglibs.standard.tag.rt.core.SetTag _jspx_th_c_005fset_005f0 = (org.apache.taglibs.standard.tag.rt.core.SetTag) _005fjspx_005ftagPool_005fc_005fset_0026_005fvar_005fvalue_005fnobody.get(org.apache.taglibs.standard.tag.rt.core.SetTag.class);
    boolean _jspx_th_c_005fset_005f0_reused = false;
    try {
      _jspx_th_c_005fset_005f0.setPageContext(_jspx_page_context);
      _jspx_th_c_005fset_005f0.setParent(null);
      // /commons/include/get.jsp(5,0) name = var type = java.lang.String reqTime = false required = false fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
      _jspx_th_c_005fset_005f0.setVar("ctx");
      // /commons/include/get.jsp(5,0) name = value type = javax.el.ValueExpression reqTime = true required = false fragment = false deferredValue = true expectedTypeName = java.lang.Object deferredMethod = false methodSignature = null
      _jspx_th_c_005fset_005f0.setValue(new org.apache.jasper.el.JspValueExpression("/commons/include/get.jsp(5,0) '${pageContext.request.contextPath}'",_jsp_getExpressionFactory().createValueExpression(_jspx_page_context.getELContext(),"${pageContext.request.contextPath}",java.lang.Object.class)).getValue(_jspx_page_context.getELContext()));
      int _jspx_eval_c_005fset_005f0 = _jspx_th_c_005fset_005f0.doStartTag();
      if (_jspx_th_c_005fset_005f0.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
        return true;
      }
      _005fjspx_005ftagPool_005fc_005fset_0026_005fvar_005fvalue_005fnobody.reuse(_jspx_th_c_005fset_005f0);
      _jspx_th_c_005fset_005f0_reused = true;
    } finally {
      org.apache.jasper.runtime.JspRuntimeLibrary.releaseTag(_jspx_th_c_005fset_005f0, _jsp_getInstanceManager(), _jspx_th_c_005fset_005f0_reused);
    }
    return false;
  }

  private boolean _jspx_meth_c_005fset_005f1(javax.servlet.jsp.PageContext _jspx_page_context)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  c:set
    org.apache.taglibs.standard.tag.rt.core.SetTag _jspx_th_c_005fset_005f1 = (org.apache.taglibs.standard.tag.rt.core.SetTag) _005fjspx_005ftagPool_005fc_005fset_0026_005fvar_005fvalue_005fnobody.get(org.apache.taglibs.standard.tag.rt.core.SetTag.class);
    boolean _jspx_th_c_005fset_005f1_reused = false;
    try {
      _jspx_th_c_005fset_005f1.setPageContext(_jspx_page_context);
      _jspx_th_c_005fset_005f1.setParent(null);
      // /commons/include/get.jsp(6,0) name = var type = java.lang.String reqTime = false required = false fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
      _jspx_th_c_005fset_005f1.setVar("emr");
      // /commons/include/get.jsp(6,0) name = value type = javax.el.ValueExpression reqTime = true required = false fragment = false deferredValue = true expectedTypeName = java.lang.Object deferredMethod = false methodSignature = null
      _jspx_th_c_005fset_005f1.setValue(new org.apache.jasper.el.JspValueExpression("/commons/include/get.jsp(6,0) '${emrContextPath}'",_jsp_getExpressionFactory().createValueExpression(_jspx_page_context.getELContext(),"${emrContextPath}",java.lang.Object.class)).getValue(_jspx_page_context.getELContext()));
      int _jspx_eval_c_005fset_005f1 = _jspx_th_c_005fset_005f1.doStartTag();
      if (_jspx_th_c_005fset_005f1.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
        return true;
      }
      _005fjspx_005ftagPool_005fc_005fset_0026_005fvar_005fvalue_005fnobody.reuse(_jspx_th_c_005fset_005f1);
      _jspx_th_c_005fset_005f1_reused = true;
    } finally {
      org.apache.jasper.runtime.JspRuntimeLibrary.releaseTag(_jspx_th_c_005fset_005f1, _jsp_getInstanceManager(), _jspx_th_c_005fset_005f1_reused);
    }
    return false;
  }
}
